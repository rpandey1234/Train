/*!CK:3328648050!*//*1456441051,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["d\/GKJ"]); }

__d("ChatNotificationConstants",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={NORMAL:0,NO_USER_MESSAGE_NOTIFICATION:1};},null);
__d("MercuryActionStatus",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={UNSENT:0,SUCCESS:1,UNCONFIRMED:3,FAILED_UNKNOWN_REASON:4,UNABLE_TO_CONFIRM:5,RESENT:6,RESENDING:7,ERROR:10};},null);
__d("MercuryActionType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={LOG_MESSAGE:"ma-type:log-message",USER_GENERATED_MESSAGE:"ma-type:user-generated-message",CHANGE_READ_STATUS:"ma-type:change_read_status",MARK_THREAD_SEEN:"ma-type:mark_thread_seen",CHANGE_MUTE_SETTINGS:"ma-type:change-mute-settings",SEND_MESSAGE:"ma-type:send-message",UPDATE_ACTION_ID:"ma-type:update-action-id",DELETE_MESSAGES:"ma-type:delete-messages",DELETE_THREAD:"ma-type:delete-thread",UPDATE_SNIPPET:"ma-type:update-snippet",CHANGE_ARCHIVED_STATUS:"ma-type:change-archived-status",CHANGE_FOLDER:"ma-type:change-folder",ADD_PARTICIPANTS:"ma-type:add-participants",CANCEL_ATTACHMENT_PLACEHOLDER:"ma-type:cancel-attachment-placeholder",CONFIRM_ATTACHMENT_PLACEHOLDER:"ma-type:confirm-attachment-placeholder",UNPIN_THREAD:"ma-type:unpin-thread",CHANGE_FLAG:"ma-type:change_flag",MOVE_PENDING_TO_INBOX:"ma-type:move_pending_to_inbox",UPDATE_BLOCKER_STATUS:"ma-type:update-blocker-status",UPDATE_BLOCKEE_STATUS:"ma-type:update-blockee-status",CREATE_PAGE_ADMIN_NOTE:"ma-type:create-page-admin-note",REPLACE_MESSAGE:"ma-type:replace-message",UPDATE_CUSTOM_LIKE:"ma-type:update_custom_like",UNWRAP_MESSAGE:"ma-type:unwrap-message"};},null);
__d("MercuryAPIArgsSource",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={CHAT:"chat",JEWEL:"jewel",MERCURY:"mercury",MERCURYSYNC:"mercury_sync",WEBMESSENGER:"web_messenger",MESSENGER:"messenger"};},null);
__d("MercuryAttachmentContentType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={PHOTO:"attach:image",VIDEO:"attach:video",MUSIC:"attach:music",VOICE:"attach:voice",TEXT:"attach:text",MSWORD:"attach:ms:word",MSXLS:"attach:ms:xls",MSPPT:"attach:ms:ppt",ORION:"attach:orion",SHOERACK_INVITATION:"attach:shoerackinvite",UNKNOWN:"attach:unknown"};},null);
__d("MercuryAttachmentType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={ERROR:"error",FILE:"file",PHOTO:"photo",STICKER:"sticker",SHARE:"share",UNKNOWN:"unknown",VIDEO:"video",ANIMATED_IMAGE:"animated_image",EMOJI_LIKE:"emoji_like",GIFT:"gift"};},null);
__d("MercuryAudioType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={AudioClip:"fb_voice_message",VoiceMessageWithTranscript:"fb_voice_message_with_transcript"};},null);
__d("MercuryErrorType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={SERVER:1,TRANSPORT:2,TIMEOUT:3};},null);
__d("MercuryGlobalActionType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={MARK_ALL_READ:"mga-type:mark-all-read"};},null);
__d("MercuryLogMessageType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={SUBSCRIBE:"log:subscribe",UNSUBSCRIBE:"log:unsubscribe",VIDEO_CALL:"log:video-call",PHONE_CALL:"log:phone-call",THREAD_NAME:"log:thread-name",THREAD_IMAGE:"log:thread-image",SERVER_ERROR:"log:error-msg",LIVE_LISTEN:"log:live-listen",WALLPAPER:"log:wallpaper",ORION:"log:orion",SWITCH_TO_WORK:"log:switch",PAGE_REPLY:"log:page-reply",GENERIC_ADMIN_TEXT:"log:generic-admin-text"};},null);
__d("MercuryParticipantTypes",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={USER:"user",THREAD:"thread",EVENT:"event",PAGE:"page",FRIEND:"friend",FB4C:"fb4c",NON_FRIEND:"non_friend"};},null);
__d("MercuryPayloadSource",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={UNKNOWN:"unknown",CLIENT_CHANNEL_MESSAGE:"client_channel_message",CLIENT_SEND_MESSAGE:"client_send_message",CLIENT_CHANGE_ARCHIVED_STATUS:"client_change-archived_status",CLIENT_CHANGE_FOLDER:"client_change_folder",CLIENT_CHANGE_MUTE_SETTINGS:"client_change_mute_settings",CLIENT_CHANGE_READ_STATUS:"client_change_read_status",CLIENT_CHANGE_CUSTOM_LIKE:"client_change_custom_like",CLIENT_MARK_THREAD_SEEN:"client_mark_thread_seen",CLIENT_ADD_PARTICIPANTS:"client_add_participants",CLIENT_FETCH_PARTICIPANTS:"client_fetch_participants",CLIENT_DELETE_MESSAGES:"client_delete_messages",CLIENT_DELETE_THREAD:"client_delete_thread",CLIENT_UPDATE_SNIPPET:"client_update_snippet",CLIENT_HANDLE_ERROR:"client_handle_error",CLIENT_UNPIN_THREAD:"client_unpin_thread",CLIENT_CHANGE_FLAG:"client_change_flag",CLIENT_MOVE_PENDING_TO_INBOX:"client_move_pending_to_inbox",CLIENT_CREATE_PAGE_ADMIN_NOTE:"client_create_page_admin_note",CLIENT_UNWRAP_MESSAGE:"client_unwrap_message",SERVER_INITIAL_DATA:"server_initial_data",SERVER_SEND_MESSAGE:"server_send_message",SERVER_CHANGE_ARCHIVED_STATUS:"server_change_archived_status",SERVER_CHANGE_READ_STATUS:"server_change_read_status",SERVER_MARK_FOLDER_READ:"server_mark_folder_read",SERVER_MARK_SEEN:"server_mark_seen",SERVER_FETCH_PARTICIPANTS:"server_fetch_participants",SERVER_FETCH_THREAD_INFO:"server_fetch_thread_info",SERVER_FETCH_THREADLIST_INFO:"server_fetch_threadlist_info",SERVER_STANDALONE_NOTIFICATIONS:"server_standalone_notifications",SERVER_THREAD_SYNC:"server_thread_sync",SERVER_TAB_PRESENCE:"server_tab_presence",SERVER_UNREAD_THREADS:"server_unread_threads",SERVER_SEARCH:"server_search",SERVER_CHANGE_FLAG:"server_change_flag",SERVER_INVALIDATE_THREAD_STATE:"server_invalidate_thread_state",SERVER_INVALIDATE_GLOBAL_STATE:"server_invalidate_global_state"};},null);
__d("MercurySourceType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={CHAT_ORCA:"source:chat:orca",CHAT_IPHONE:"source:chat:iphone",CHAT_JABBER:"source:chat:jabber",CHAT_MEEBO:"source:chat:meebo",CHAT_WEB:"source:chat:web",CHAT_TEST:"source:chat:test",CHAT_FORWARD_DIALOG:"source:chat:forward",CHAT:"source:chat",EMAIL:"source:email",EVENT_MESSAGE_BLAST:"source:event_message_blast",GIGABOXX_API:"source:gigaboxx:api",GIGABOXX_BLAST:"source:gigaboxx:blast",GIGABOXX_EMAIL_REPLY:"source:gigaboxx:emailreply",GIGABOXX_MOBILE:"source:gigaboxx:mobile",GIGABOXX_WAP:"source:gigaboxx:wap",GIGABOXX_WEB:"source:gigaboxx:web",LEIA:"source:leia",MESSENGER_WEB:"source:messenger:web",SAM_UFI:"source:sam:ufi",SHARE_DIALOG:"source:share:dialog",SEND_PLUGIN:"source:sendplugin",SMS:"source:sms",TEST:"source:test",TITAN_WAP:"source:titan:wap",TITAN_M_BASIC:"source:titan:m_basic",TITAN_M_FREE:"source:titan:m_free_basic",TITAN_M_JAPAN:"source:titan:m_japan",TITAN_M_MINI:"source:titan:m_mini",TITAN_M_TOUCH:"source:titan:m_touch",TITAN_M_APP:"source:titan:m_app",TITAN_M_TABLET:"source:titan:m_tablet",TITAN_M_ZERO:"source:titan:m_zero",TITAN_M_TALK:"source:titan:m_talk",TITAN_WEB:"source:titan:web",TITAN_FACEWEB_ANDROID:"source:titan:faceweb_android",TITAN_FACEWEB_BUFFY:"source:titan:faceweb_buffy",TITAN_FACEWEB_IPAD:"source:titan:faceweb_ipad",TITAN_FACEWEB_IPHONE:"source:titan:faceweb_iphone",TITAN_FACEWEB_UNKNOWN:"source:titan:faceweb_unknown",TITAN_API:"source:titan:api",TITAN_API_MOBILE:"source:titan:api_mobile",TITAN_ORCA:"source:titan:orca",TITAN_EMAIL_REPLY:"source:titan:emailreply",MOBILE:"source:mobile",PAGE_PLATFORM_API:"source:page_platform_api",UNKNOWN:"source:unknown",WEB:"source:web",HELPCENTER:"source:helpcenter",NEW_SHARE_DIALOG:"source:share:dialog:new",PAID_PROMOTION:"source:paid_promotion",BUFFY_SMS:"source:buffy:sms",WEBRTC_MOBILE:"source:webrtc:mobile",MESSENGER_COMMERCE:"source:messenger:commerce",MESSENGER_BOT:"source:bot",PAGES_PRIVATE_REPLY:"source:pages:private_reply",MESSENGER_FORWARD_DIALOG:"source:messenger:forward",MESSENGER_AD:"source:messenger:ad",MARKETPLACE:"source:marketplace",MESSENGER_LEAD_GEN:"source:messenger:lead_gen"};},null);
__d("MessagingGenericAdminTextType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={CONFIRM_FRIEND_REQUEST:"confirm_friend_request",ACCEPT_PENDING_THREAD:"accept_pending_thread",RAMP_UP_WELCOME_MESSAGE:"ramp_up_welcome_message",CHANGE_THREAD_THEME:"change_thread_theme",CHANGE_THREAD_ICON:"change_thread_icon",GROUP_THREAD_CREATED:"group_thread_created",THREAD_EPHEMERAL_SEND_MODE:"thread_ephemeral_send_mode",INVITE_ACCEPTED:"invite_accepted",MESSENGER_INVITE_SENT:"messenger_invite_sent",TURN_ON_PUSH:"turn_on_push",JOURNEY_PROMPT_COLOR:"journey_prompt_color",JOURNEY_PROMPT_LIKE:"journey_prompt_like",JOURNEY_PROMPT_NICKNAME:"journey_prompt_nickname",JOURNEY_PROMPT_SETUP:"journey_prompt_setup",CHANGE_THREAD_NICKNAME:"change_thread_nickname",BOT_THREAD_SUBSCRIPTION:"bot_thread_subscription",RTC_CALL_LOG:"rtc_call_log",JOURNEY_PROMPT_BOT:"journey_prompt_bot",RIDE_ORDERED_MESSAGE:"ride_ordered_message",JOURNEY_PROMPT_NEW_SETUP:"journey_prompt_new_setup",LIGHTWEIGHT_EVENT_CREATE:"lightweight_event_create",LIGHTWEIGHT_EVENT_DELETE:"lightweight_event_delete",LIGHTWEIGHT_EVENT_NOTIFY:"lightweight_event_notify",LIGHTWEIGHT_EVENT_UPDATE:"lightweight_event_update",AD_MANAGE_MESSAGE:"ad_manage_message"};},null);
__d("MessagingTag",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={GROUPS:"groups",UNREAD:"unread",FLAGGED:"flagged",ACTION_ARCHIVED:"action:archived",INBOX:"inbox",OTHER:"other",PENDING:"pending",MONTAGE:"montage",EVENT:"event",SENT:"sent",SPAM:"spam",UPDATES:"broadcasts_inbox",BCC:"header:bcc",FILTERED_CONTENT:"filtered_content",FILTERED_CONTENT_BH:"filtered_content_bh",FILTERED_CONTENT_ACCOUNT:"filtered_content_account",FILTERED_CONTENT_QUASAR:"filtered_content_quasar",FILTERED_CONTENT_INVALID_APP:"filtered_content_invalid_app",UNAVAILABLE_ATTACHMENT:"unavailable_attachment",ARCHIVED:"archived",EMAIL:"email",VOICEMAIL:"voicemail",SPAM_SPOOFING:"spam:spoofing",SPOOF_WARNING:"MTA:spoof_warning",SMS_TAG_ROOT:"SMSShortcode:",APP_ID_ROOT:"app_id:",DOMAIN_AUTH_PASS:"MTA:dmarc:pass",DOMAIN_AUTH_FAIL:"MTA:dmarc:fail",MTA_SYSTEM_MESSAGE:"MTA:system_message",EMAIL_MESSAGE:"source:email",MARKETPLACE:"marketplace"};},null);
__d("PageMessageEnumTag",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={FLAG:"flag",LOW_VALUE:"low_value",SPAM_SPOOFING:"spam_spoofing"};},null);
__d("PhotoResizeModeConst",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={CONTAIN:"s",COVER:"p"};},null);
__d("StoryAttachmentStyle",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={FALLBACK:"fallback",SHARE:"share",OG_COMPOSER_SIMPLE:"og_composer_simple",SPORTS_MATCHUP:"sports_matchup",SHARE_LARGE_IMAGE:"share_large_image",PHOTO:"photo",COVER_PHOTO:"cover_photo",ALBUM:"album",NEW_ALBUM:"new_album",COUPON:"coupon",QUESTION:"question",ANSWER:"answer",OPTION:"option",GALLERY:"gallery",STREAM_PUBLISH:"stream_publish",MUSIC_AGGREGATION:"music_aggregation",ITEM_LIST:"list",HIGH_SCORE:"high_score",SCORE_LEADERBOARD:"score_leaderboard",FRIEND_LIST:"friend_list",CHECKIN:"checkin",POPULAR_OBJECTS:"popular_objects",AVATAR_LIST:"avatar_list",AVATAR:"avatar",AVATAR_WITH_VIDEO:"avatar_with_video",EVENT:"event",CANCELED_EVENT:"canceled_event",MINUTIAE_EVENT:"minutiae_event",EXPERIENCE:"experience",LIFE_EVENT:"life_event",TRAVEL_SLIDESHOW_LIFE_EVENT:"travel_slideshow_life_event",GIFT:"gift",IMAGE_SHARE:"image_share",ANIMATED_IMAGE_SHARE:"animated_image_share",ANIMATED_IMAGE_AUTOPLAY:"animated_image_autoplay",ANIMATED_IMAGE_VIDEO:"animated_image_video",ANIMATED_IMAGE_VIDEO_AUTOPLAY:"animated_image_video_autoplay",NOTE:"note",TOPIC:"topic",FILE_UPLOAD:"file_upload",NOTIFICATION_TARGET:"notification_target",UNAVAILABLE:"unavailable",PAGE_RECOMMENDATION:"page_recommendation",PAGE_VIDEO_PLAYLIST:"page_video_playlist",VIDEO:"video",VIDEO_INLINE:"video_inline",VIDEO_AUTOPLAY:"video_autoplay",VIDEO_SHARE:"video_share",VIDEO_SHARE_HIGHLIGHTED:"video_share_highlighted",VIDEO_SHARE_YOUTUBE:"video_share_youtube",VIDEO_DIRECT_RESPONSE:"video_direct_response",VIDEO_DIRECT_RESPONSE_AUTOPLAY:"video_direct_response_autoplay",MAP:"map",OG_MAP:"og_map",PRODUCT:"product",EXTERNAL_PRODUCT:"external_product",FITNESS_COURSE:"fitness_course",APPLICATION:"application",STICKER:"sticker",EXTERNAL_OG_PRODUCT:"external_og_product",TRAVEL_LOG:"travel_log",MULTI_SHARE:"multi_share",MULTI_SHARE_NO_END_CARD:"multi_share_no_end_card",MULTI_SHARE_SEARCH_END_CARD:"multi_share_search_end_card",YEAR_IN_REVIEW:"year_in_review",AVATAR_LARGE_COVER:"avatar_large_cover",COMMERCE_PRODUCT_ITEM:"commerce_product_item",COMMERCE_STORE:"commerce_store",THIRD_PARTY_PHOTO:"third_party_photo",PROMPT:"prompt",BIRTHDAY:"birthday",DONATIONS_CAMPAIGN:"donations_campaign",DONATE_PROMPT:"donate_prompt",DISCUSSION_CONVERSATION:"discussion_conversation",DISCUSSION_COMMENT:"discussion_comment",GROUP_SELL_PRODUCT_ITEM:"group_sell_product_item",GROUP_SELL_PRODUCT_ITEM_MARK_AS_SOLD:"group_sell_mark_as_sold",GAMETIME:"gametime",GAMETIME_PLAY:"gametime_play",GROUP_REPORTED_POST_QUEUE:"group_reported_post_queue",GROUP_PENDING_POST_QUEUE:"group_pending_post_queue",GROUP_JOIN_REQUEST_QUEUE:"group_join_request_queue",GREETING_CARD:"greeting_card",LEAD_GEN:"lead_gen",ATTACHED_STORY:"attached_story",POST_CHANNEL:"post_channel",TEXT_FOR_COLLAGE:"text_for_collage",SOUVENIR:"souvenir",SLIDESHOW:"slideshow",ORION:"orion",ORION_REQUEST:"orion_request",INSTANT_ARTICLE:"instant_article",MOMENTS_APP_INVITATION:"moments_app_invitation",MOMENTS_APP_PHOTO_REQUEST:"moments_app_photo_request",RIDE_ORDERED:"ride_ordered",RIDE_RECEIPT:"ride_receipt",BUSINESS_MESSAGE_ITEMS:"business_message_items",RETAIL_CANCELLATION:"retail_cancellation",RETAIL_PROMOTION:"retail_promotion",RETAIL_ITEM:"retail_item",RETAIL_NOW_IN_STOCK:"retail_now_in_stock",RETAIL_RECEIPT:"retail_receipt",RETAIL_SHIPMENT:"retail_shipment",RETAIL_SHIPMENT_FOR_SUPPORTED_CARRIER:"retail_shipment_for_supported_carrier",RETAIL_SHIPMENT_FOR_UNSUPPORTED_CARRIER:"retail_shipment_for_unsupported_carrier",RETAIL_SHIPMENT_TRACKING_EVENT:"retail_shipment_tracking_event",RETAIL_SHIPMENT_TRACKING_EVENT_ETA:"retail_shipment_tracking_event_eta",RETAIL_SHIPMENT_TRACKING_EVENT_IN_TRANSIT:"retail_shipment_tracking_event_in_transit",RETAIL_SHIPMENT_TRACKING_EVENT_OUT_FOR_DELIVERY:"retail_shipment_tracking_event_out_for_delivery",RETAIL_SHIPMENT_TRACKING_EVENT_DELAYED:"retail_shipment_tracking_event_delayed",RETAIL_SHIPMENT_TRACKING_EVENT_DELIVERED:"retail_shipment_tracking_event_delivered",SURVEY:"survey",MESSAGE_LOCATION:"message_location",JOB_OFFER:"job_offer",GROUP_ADD_MEMBERS:"group_add_memebers",RTC_CALL_LOG:"rtc_call_log",EVENTS_PENDING_POST_QUEUE:"events_pending_post_queue",EVENT_CALENDAR:"event_calendar",FACEPILE:"facepile",ATTRIBUTED_SHARE:"attributed_share",VIDEO_CINEMAGRAPH:"video_cinemagraph",LOCAL_CONTEXT_SHARE:"local_context_share",H_SCROLL:"h_scroll",EGO_HSCROLL:"ego_hscroll",MEDIA_QUESTION:"media_question",RICH_MEDIA:"rich_media",SQUARE_IMAGE_SHARE:"square_image_share",RETAIL_AGENT_ITEM_SUGGESTION:"retail_agent_item_suggestion",RETAIL_AGENT_ITEM_RECEIPT:"retail_agent_item_receipt",NOTE_COMPOSED:"note_composed",AVATAR_WITH_BIRTHDAY:"avatar_with_birthday",AIRLINE_FLIGHT_RESCHEDULE_UPDATE_BUBBLE:"airline_flight_reschedule_update_bubble",AIRLINE_CONFIRMATION:"airline_confirmation",AIRLINE_CHECK_IN:"airline_check_in",AIRLINE_BOARDING_PASS:"airline_boarding_pass",AIRLINE_FLIGHT_RESCHEDULE_UPDATE:"airline_flight_reschedule_update",LIGHTBOX_VIDEO:"lightbox_video",GLOBALLY_DELETED_MESSAGE_PLACEHOLDER:"globally_deleted_message_placeholder",GENIE_MESSAGE:"genie_message",MOVIE_BOT_MOVIE_LIST:"movie_bot_movie_list",MOVIE_BOT_MOVIE_SHOWTIME_LIST:"movie_bot_movie_showtime_list",AVATAR_WITH_EGO_ACTION:"avatar_with_ego_action",EVENT_TICKET:"event_ticket",VERTICAL_ATTACHMENT_LIST:"vertical_attachment_list",INSTANT_ARTICLE_LEGACY:"instant_article_legacy",FUNDRAISER_PAGE:"fundraiser_page",FINANCIAL_BILL_PAYMENT_REQUEST:"financial_bill_payment_request",GOODWILL_THROWBACK_FRIENDVERSARY_POLAROIDS_CARD:"goodwill_throwback_friendversary_polaroids_card",SAHELI_IMAGE:"saheli_image",LARGE_IMAGE_LIKE:"large_image_like",ASK_FRIENDS:"ask_friends",CULTURAL_MOMENT:"cultural_moment",TELEPHONE_CALL_LOG:"telephone_call_log",SUPER_EMOJI:"super_emoji",BOOK:"book",SUBTOPIC_CUSTOMIZATION_QUESTION:"subtopic_customization_question",SUBTOPIC_CUSTOMIZATION_OPTION:"subtopic_customization_option",RESTAURANT:"restaurant",CONNECTION_QUESTION:"connection_question",CONNECTION_QUESTION_OPTION:"connection_question_option",PYMI_ITEM:"pymi_item",GOODWILL_THROWBACK_FRIENDVERSARY_COLLAGE_CARD:"goodwill_throwback_friendversary_collage_card",CITY:"city",AVATAR_WITH_SHARE:"avatar_with_share",LIGHTWEIGHT_PLACE:"lightweight_place",QUOTED_SHARE:"quoted_share",SMS_LOG:"sms_log",CENTERED_TEXT:"centered_text",GOODWILL_THROWBACK_FRIENDVERSARY_DATA_CARD:"goodwill_throwback_friendversary_data_card",GOODWILL_THROWBACK_FACEVERSARY_COLLAGE_CARD:"goodwill_throwback_faceversary_collage_card",MESSAGE_EVENT:"message_event",MESSAGE_THREAD:"message_thread",QUOTE:"quote",VOTER_REGISTRATION_SHARE:"voter_registration_share",AIRLINE_ITINERARY:"airline_itinerary",AIRLINE_UPDATE:"airline_update",PLACE_LIST:"place_list",AIRLINE_CHECKIN_REMINDER:"airline_checkin_reminder",MINUTIAE_UNIT:"minutiae_unit",INSTANT_ARTICLE_PHOTO:"instant_article_photo",INSTANT_ARTICLE_VIDEO:"instant_article_video",PHOTO_LINK_SHARE:"photo_link_share",BUSINESS_LOCATION:"business_location",GOODWILL_WEATHER:"goodwill_weather",TRANSACTION_INVOICE:"transaction_invoice"};},null);
__d('AvailableListConstants',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={ON_AVAILABILITY_CHANGED:'buddylist/availability-changed',ON_UPDATE_ERROR:'buddylist/update-error',ON_UPDATED:'buddylist/updated',ON_CHAT_NOTIFICATION_CHANGED:'chat-notification-changed',OFFLINE:0,IDLE:1,ACTIVE:2,MOBILE:3,WEB_STATUS:'webStatus',FB_APP_STATUS:'fbAppStatus',MESSENGER_STATUS:'messengerStatus',OTHER_STATUS:'otherStatus',STATUS_ACTIVE:'active',STATUS_IDLE:'idle',STATUS_OFFLINE:'offline'};f.exports=h;},null);
__d('LastActiveTimes',['fbt','ServerTime'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={};function j(n){if(!n||n<0)return '';var o=c('ServerTime').get()/1000-n,p=Math.floor(o/60),q=Math.floor(p/60),r=Math.floor(q/24);if(p<=1){return h._("{count}m",[h.param('count',1)]);}else if(p<60){return h._("{count}m",[h.param('count',p)]);}else if(q<24){return h._("{count}h",[h.param('count',q)]);}else if(r<3){return h._("{count}d",[h.param('count',r)]);}else return '';}function k(n,o){if(!(n in i)||i[n]<o)i[n]=o;}function l(n){if(n in i){return i[n];}else return 0;}var m={update:function(n){for(var o in n)k(o,n[o]);},getShortDisplay:function(n){return j(l(n));},get:function(n){return l(n);},getDebugData:function(){return i;}};f.exports=m;},null);
__d('PresenceStatus',['ArbiterMixin','AvailableListConstants','BanzaiODS','ChatVisibility','CurrentUser','LastActiveTimes','Set','PresencePrivacy','ServerTime','createObjectFrom','debounceAcrossTransitions'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();c('BanzaiODS').setEntitySample('presence',.0001);var h={},i={},j={},k=Object.assign({},c('ArbiterMixin')),l=c('debounceAcrossTransitions')(function(){return k.inform('change');},0);Object.assign(k,{resetPresenceData:function(){h={};i={};},reset:function(){k.resetPresenceData();j={};},get:function(m){if(m==c('CurrentUser').getID())return c('ChatVisibility').isOnline()?c('AvailableListConstants').ACTIVE:c('AvailableListConstants').OFFLINE;var n=c('AvailableListConstants').OFFLINE;if(m in h)n=h[m];if(!c('PresencePrivacy').allows(m))n=c('AvailableListConstants').OFFLINE;return n;},getCapabilities:function(m){var n=k.get(m);if(n==c('AvailableListConstants').OFFLINE)return 0;var o=i[m];return o?o:0;},isPlayingCanvasGameUser:function(m){return !!j[m];},getGroup:function(m){return m.some(function(n){if(n==c('CurrentUser').getID())return false;return k.get(n)===c('AvailableListConstants').ACTIVE;})?c('AvailableListConstants').ACTIVE:c('AvailableListConstants').OFFLINE;},set:function(m,n,o,p,q,r){if(m==c('CurrentUser').getID())return false;var s;if(n!==null&&n!==undefined){n=n==c('AvailableListConstants').ACTIVE?c('AvailableListConstants').ACTIVE:c('AvailableListConstants').OFFLINE;var t=k.get(m);s=t!=n;if(s&&t==c('AvailableListConstants').ACTIVE||n==c('AvailableListConstants').ACTIVE){var u={};u[m]=c('ServerTime').get()/1000;c('LastActiveTimes').update(u);}h[m]=n;}var v=false;if(q){v=k.getCapabilities(m)!=q;i[m]=q;}var w=s||v;if(w&&!r)l();return w;},setPlayingCanvasGameFriends:function(m){j=c('createObjectFrom')(m);},getOnlineIDs:function(){var m,n=[];for(m in h)if(k.get(m)===c('AvailableListConstants').ACTIVE)n.push(m);return n;},getOnlineCount:function(){return k.getOnlineIDs().length;},getPresenceStats:function(){var m=0,n=0,o=0;for(var p in h){m+=1;switch(k.get(p)){case c('AvailableListConstants').OFFLINE:n+=1;break;case c('AvailableListConstants').ACTIVE:o+=1;break;default:break;}}return {total:m,offline:n,active:o};},getDebugInfo:function(m){return {id:m,presence:h[m]};},getAllDebugInfo:function(){return {presence:h};},setMulti:function(m,n){var o=false;for(var p in m)k.set(p,m[p].a,false,n,m[p].c,true)&&(o=true);if(o)l();},setMultiChatproxy:function(m){var n={};for(var o in m){if(m[o].lat)n[o]=m[o].lat;var p=m[o].p;if(p!==undefined)k.set(o,p,false,'chatproxy',m[o].vc,true);}c('LastActiveTimes').update(n);l();},setMultiActive:function(m,n){var o=false;m.forEach(function(p){k.set(p,c('AvailableListConstants').ACTIVE,false,n,null,true)&&(o=true);});if(o)l();}});f.exports=k;},null);
__d('ChatproxyPresence',['Arbiter','AvailableListConstants','AvailableListInitialData','ChannelConstants','CurrentUser','LastActiveTimes','PresenceStatus','debounceAcrossTransitions'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i){'use strict';this.$ChatproxyPresence1=i;this.$ChatproxyPresence2=false;this.$ChatproxyPresence3=c('AvailableListInitialData').chatNotif;var j=c('AvailableListInitialData').activeList,k=c('AvailableListInitialData').lastActiveTimes;if(j)c('PresenceStatus').setMultiActive(j,'available_list_active');if(k&&!Array.isArray(k))c('LastActiveTimes').update(k);}h.prototype.subscribe=function(){'use strict';c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('chatproxy-presence'),this.updatePresenceInfo.bind(this));c('Arbiter').subscribe(c('ChannelConstants').ON_INVALID_HISTORY,function(){this.$ChatproxyPresence2=true;}.bind(this));};h.prototype.updatePresenceInfo=function(i,j){'use strict';if(this.$ChatproxyPresence2){this.$ChatproxyPresence2=false;c('PresenceStatus').resetPresenceData();}j=j.obj;var k=j.buddyList;c('PresenceStatus').setMultiChatproxy(k);var l=false;if(j.chatNotif!==undefined)l=this.$ChatproxyPresence3!==j.chatNotif;if(l)this.$ChatproxyPresence3=j.chatNotif;if(j.gamers)c('PresenceStatus').setPlayingCanvasGameFriends(j.gamers);if(l)this.$ChatproxyPresence1(c('AvailableListConstants').ON_CHAT_NOTIFICATION_CHANGED,this.$ChatproxyPresence3);c('debounceAcrossTransitions')(function(){this.$ChatproxyPresence1(c('AvailableListConstants').ON_AVAILABILITY_CHANGED);}.bind(this),0)();};h.prototype.getWebChatNotification=function(){'use strict';return this.$ChatproxyPresence3;};f.exports=h;},null);
__d("TypingStates",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={INACTIVE:0,TYPING:1,QUITTING:2};f.exports=h;},null);
__d('AvailableList',['Arbiter','ArbiterMixin','AsyncRequest','AvailableListConstants','AvailableListInitialData','BanzaiODS','Bootloader','ChannelConstants','ChatConfig','ChatproxyPresence','ChatVisibility','ErrorUtils','JSLogger','LastActiveTimes','PresencePrivacy','PresenceStatus','Run','ServerTime','ShortProfiles','TypingStates','debounceAcrossTransitions','emptyFunction','requireWeak'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();c('BanzaiODS').setEntitySample('presence',.0001);var h=babelHelpers['extends']({},c('AvailableListConstants'),c('ArbiterMixin'));h.subscribe([c('AvailableListConstants').ON_AVAILABILITY_CHANGED,c('AvailableListConstants').ON_UPDATE_ERROR],function(p,q){c('Arbiter').inform(p,q);});var i=c('debounceAcrossTransitions')(function(){return h.inform(c('AvailableListConstants').ON_AVAILABILITY_CHANGED);},0);function j(p,q,r,s,t){var u=c('PresenceStatus').set(p,q,r,s,t);if(u){var v=c('debounceAcrossTransitions')(function(){return h.inform(c('AvailableListConstants').ON_AVAILABILITY_CHANGED,p);},0);v();}}function k(p){var q=p.payload.availability||{};for(var r in q)j(r&&r.toString(),q[r].a,true,'mercury_tabs',q[r].c,q[r].p);}function l(p){var q=h.getDebugInfo(p),r=q.presence==c('AvailableListConstants').ACTIVE;new (c('AsyncRequest'))('/ajax/mercury/tabs_presence.php').setData({target_id:p,to_online:r,presence_source:q.overlaySource,presence_time:q.overlayTime}).setHandler(k).setErrorHandler(c('emptyFunction')).setAllowCrossPageTransition(true).send();}function m(p,q){q.chat_config=c('ChatConfig').getDebugInfo();q.available_list_debug_info={};c('PresenceStatus').getOnlineIDs().forEach(function(r){q.available_list_debug_info[r]=h.getDebugInfo(r);});}var n=undefined;try{n=new (c('ChatproxyPresence'))(function(event){h.inform(event);});n.subscribe();}catch(o){c('ErrorUtils').reportError&&c('ErrorUtils').reportError(o,false);}Object.assign(h,{getChatproxyPresenceObject:function(){return n;},get:function(p){return c('PresenceStatus').get(p);},updateForID:function(p){l(p);if(c('PresencePrivacy').getVisibility()==c('PresencePrivacy').ONLINE)c('Run').onAfterLoad(function(){return (c('Bootloader').loadModules(["ChannelManager","ChannelTransport"],function(q,r){r.sendAdditionalBuddyRequest(q.getCompleteConfig(),p);}));});},getWebChatNotification:function(){return n&&n.getWebChatNotification();},isReady:function(){return !!n;},set:function(p,q,r,s){j(p,q,true,r,s);},getDebugInfo:function(p){var q=c('PresenceStatus').getDebugInfo(p),r=c('ShortProfiles').getNow(p);if(r)q.name=r.name;return q;}});c('Arbiter').subscribe(c('JSLogger').DUMP_EVENT,m);c('PresencePrivacy').subscribe(['privacy-changed','privacy-availability-changed','privacy-user-presence-response'],i);c('requireWeak')('ChannelConnection',function(p){return (p.subscribe([p.CONNECTED,p.RECONNECTING,p.SHUTDOWN,p.MUTE_WARNING,p.UNMUTE_WARNING],i));});c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('buddylist_overlay'),function(p,q){var r={},s=q.obj.overlay;for(var t in s){h.set(t,s[t].a,s[t].s||'channel',s[t].vc);if(s[t].la)r[t]=s[t].la;}c('LastActiveTimes').update(r);});c('Arbiter').subscribe([c('ChannelConstants').getArbiterType('typ'),c('ChannelConstants').getArbiterType('ttyp')],function(p,q){var r=q.obj;if(r.st===c('TypingStates').TYPING){var s=r.from;if(c('ChatVisibility').isOnline()){c('BanzaiODS').bumpEntityKey('presence','stale_presence_check_typing');var t=c('PresenceStatus').get(s);if(t!=c('AvailableListConstants').ACTIVE){var u=c('LastActiveTimes').get(s)*1000,v=c('ServerTime').get();if(!u){c('BanzaiODS').bumpEntityKey('presence','no_detailed_presence_typing');}else if(v-u>5*60*1000){var w='stale_presence_typing',x=v-u;if(x<10*60*1000){w+='600';}else if(x<60*60*1000)w+='3600';c('BanzaiODS').bumpEntityKey('presence',w);}}}h.set(s&&s.toString(),c('AvailableListConstants').ACTIVE,'channel-typing');}});c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('messaging'),function(p,q){if(!c('ChatVisibility').isOnline())return;var r=q.obj;if(r.message&&r.message.timestamp&&r.message.sender_fbid){var s=c('ServerTime').get(),t=r.message.timestamp;if(s-t<2*60*1000){c('BanzaiODS').bumpEntityKey('presence','stale_presence_check');var u=r.message.sender_fbid,v=c('PresenceStatus').get(u);if(v==c('AvailableListConstants').ACTIVE)return;var w=c('LastActiveTimes').get(u)*1000;if(!w){c('BanzaiODS').bumpEntityKey('presence','no_detailed_presence');}else if(t-w>5*60*1000){var x='stale_presence',y=t-w;if(y<10*60*1000){x+='600';}else if(y<60*60*1000)x+='3600';c('BanzaiODS').bumpEntityKey('presence',x);}}}});f.exports=h;},null);
__d('ChatTypeaheadConstants',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={USER_TYPE:'user',THREAD_TYPE:'thread',FRIEND_TYPE:'friend',NON_FRIEND_TYPE:'non_friend',FB4C_TYPE:'fb4c',PAGE_TYPE:'page',MEETING_ROOM_PAGE_TYPE:'meeting_room_page',COMMERCE_PAGE_TYPE:'commerce_page',HEADER_TYPE:'header'};f.exports=h;},null);
__d('MercuryIDs',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={isValid:function(i){if(!i||typeof i!=='string')return false;return (/^\w{3,12}:/.test(i));},isValidThreadID:function(i){if(!h.isValid(i))return false;var j=h.tokenize(i);switch(j.type){case 'user':case 'group':case 'thread':case 'root':case 'pending':return true;default:return false;}},tokenize:function(i){if(!this.isValid(i))throw new Error('bad_id_format '+i);var j=i.indexOf(':');return {type:i.substr(0,j),value:i.substr(j+1)};},getUserIDFromParticipantID:function(i){if(!this.isValid(i))throw new Error('bad_id_format '+i);var j=h.tokenize(i),k=j.type,l=j.value;if(k!='fbid')return null;return l;},getParticipantIDFromUserID:function(i){if(isNaN(i))throw new Error('Not a user ID: '+i);return 'fbid:'+i;},getUserIDFromThreadID:function(i){if(!this.isCanonical(i))return null;return this.tokenize(i).value;},getThreadIDFromUserID:function(i){return 'user:'+i;},getThreadIDFromThreadFBID:function(i){return 'thread:'+i;},getThreadIDFromParticipantID:function(i){var j=this.getUserIDFromParticipantID(i);return j?this.getThreadIDFromUserID(j):null;},getParticipantIDFromFromThreadID:function(i){return this.getParticipantIDFromUserID(this.getUserIDFromThreadID(i)||'');},isCanonical:function(i){return this.isValid(i)&&this.tokenize(i).type==='user';},isGroupChat:function(i){return this.isValid(i)&&this.tokenize(i).type!=='user';},isLocalThread:function(i){return this.isValid(i)&&this.tokenize(i).type==='root';}};f.exports=h;},null);
__d('WebMessengerPermalinkConstants',['URI'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={ARCHIVED_PATH:'/messages/archived',BASE_PATH:'/messages',PENDING_PATH:'/messages/pending',OTHER_PATH:'/messages/other',SPAM_PATH:'/messages/spam',COMPOSE_POSTFIX_PATH:'/new',SEARCH_POSTFIX_PATH:'/search',TID_POSTFIX_PARTIAL_PATH:'/conversation-',overriddenVanities:'(archived|other|pending|spam|new|search|conversation-.*)',getURIPathForThreadID:function(i,j){return (j||h.BASE_PATH)+h.TID_POSTFIX_PARTIAL_PATH+c('URI').encodeComponent(c('URI').encodeComponent(i));},getThreadIDFromURI:function(i){var j=i.getPath().match(h.BASE_PATH+'(/[^/]*)*'+h.TID_POSTFIX_PARTIAL_PATH+'([^/]+)');if(j){var k=c('URI').decodeComponent(c('URI').decodeComponent(j[2]));return k;}},getURIPathForIDOrVanity:function(i,j){if(i.match('^'+h.overriddenVanities+'$'))i='.'+i;return (j||h.BASE_PATH)+'/'+i;},getUserIDOrVanity:function(i){var j=i.match(h.BASE_PATH+'.*/([^/]+)/?$'),k=j&&j[1],l=h.overriddenVanities;if(!k||k.match('^'+l+'$')){return false;}else if(k.match('^\\.'+l+'$')){return k.substr(1);}else return k;}};f.exports=h;},null);
__d('ChatOpenTab',['csx','cx','ChatTypeaheadConstants','ContextualThing','Event','MercuryIDs','MercuryParticipantTypes','Parent','URI','WebMessengerPermalinkConstants','curry','emptyFunction','goURI','ifRequired','requireWeak'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=null;c('requireWeak')('ChatApp',function(u){return j=u;});function k(u,v){var w=u?new (c('URI'))(c('WebMessengerPermalinkConstants').getURIPathForThreadID(u)):new (c('URI'))(c('WebMessengerPermalinkConstants').BASE_PATH+c('WebMessengerPermalinkConstants').COMPOSE_POSTFIX_PATH);if(v)w.addQueryData({ref:v});c('ifRequired')('BusinessURI.brands',function(x){return c('goURI')(x(w));},function(){return c('goURI')(w);});}function l(u,v){k(c('MercuryIDs').getThreadIDFromUserID(u),v);}function m(u,v,w){l(v,w);}function n(u,v){k(c('MercuryIDs').getThreadIDFromThreadFBID(u),v);}function o(u,v){k(null,v);}function p(u,v,w,x){c('Event').listen(u,'click',function(y){if(t.canOpenTab()){x(v,w);return y.kill();}});}function q(u,v,w,x){c('Event').listen(u,'click',function(y){if(t.canOpenTab())x(v,w);});}function r(u,v,w,x){t.impl()._logChatOpenTabEvent(u,v,w,x);}function s(u){var v=c('ContextualThing').getContext(u);return v&&c('Parent').bySelector(v,"._3qw")!==null;}var t={canOpenTab:function(){return j&&!j.isHidden();},openEmptyTab:function(u,v,w){t.impl().openEmptyTab(u,v,w);},listenOpenEmptyTab:function(u,v){p(u,null,v,t.openEmptyTab);},openThread:function(u,v,w,x,y){t.impl().openThreadTab(u,v,w,x,y);},openClientTab:function(u,v,w,x,y){var z=t.impl();z.openClientTab(u,x,y);z._logChatOpenTabEvent(v,u,null,w);},listenOpenThread:function(u,v,w){p(u,v,w,t.openThread);},openUserTab:function(u,v,w){t.impl().openUserTab(u,v,w);},openPageTab:function(u,v,w){t.impl().openPageTab(u,v,w);return true;},listenOpenUserTab:function(u,v,w){if(!s(u))p(u,v,w,t.openUserTab);},listenOpenPageTab:function(u,v,w,x){if(!s(u))p(u,v,x,c('curry')(t.openPageTab,w));},listenOpenPageTabPersistentEvent:function(u,v,w,x){if(!s(u))q(u,v,x,c('curry')(t.openPageTab,w));},openTabByType:function(u,v,w){if(v===c('ChatTypeaheadConstants').THREAD_TYPE){if(u){this.openThread(u,w);}else this.openEmptyTab(null,w);}else if(!v||v===c('MercuryParticipantTypes').FRIEND||v===c('ChatTypeaheadConstants').FRIEND_TYPE||v===c('ChatTypeaheadConstants').PAGE_TYPE||v===c('ChatTypeaheadConstants').USER_TYPE)this.openUserTab(u,w);},impl:function(){if(j&&j.isInitialized()&&!j.isHidden()&&j.chatOpenTabImpl){return j.chatOpenTabImpl;}else return {openClientTab:k,openUserTab:l,openEmptyTab:o,openThreadTab:n,openPageTab:m,_logChatOpenTabEvent:c('emptyFunction')};}};f.exports=t;},null);
__d('ChatDispatcher',['ExplicitRegistrationDispatcher','LogHistory'],function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();var j=c('LogHistory').getInstance('chat_dispatcher');h=babelHelpers.inherits(k,c('ExplicitRegistrationDispatcher'));i=h&&h.prototype;k.prototype.dispatch=function(l){j.debug('action',l.type);i.dispatch.call(this,l);};function k(){h.apply(this,arguments);}f.exports=new k({strict:false});},null);
__d('ChatTabActions',['ChatDispatcher','keyMirror'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('keyMirror')({CLOSE_TAB:null,CLOSE_ALL_TABS:null,CLOSE_FRAGILE_TABS:null,LOWER_TAB:null,OPEN_FRAGILE_TAB:null,OPEN_TAB:null,PERSIST_LOCAL_STATE:null,PROMOTE_TAB:null,RAISE_TAB:null}),i={Types:h,closeTab:function(j,k){c('ChatDispatcher').dispatch({actionType:h.CLOSE_TAB,reason:k,threadID:j});},closeAllTabs:function(){c('ChatDispatcher').dispatch({actionType:h.CLOSE_ALL_TABS});},closeFragileTabs:function(){c('ChatDispatcher').dispatch({actionType:h.CLOSE_FRAGILE_TABS});},lowerTab:function(j){c('ChatDispatcher').dispatch({actionType:h.LOWER_TAB,threadID:j});},openFragileTab:function(j){c('ChatDispatcher').dispatch({actionType:h.OPEN_FRAGILE_TAB,threadID:j});},openTab:function(j){c('ChatDispatcher').dispatch({actionType:h.OPEN_TAB,threadID:j});},persistLocalState:function(){c('ChatDispatcher').dispatch({actionType:h.PERSIST_LOCAL_STATE});},promoteTab:function(j){c('ChatDispatcher').dispatch({actionType:h.PROMOTE_TAB,threadID:j});},raiseTab:function(j,k,l){c('ChatDispatcher').dispatch({actionType:h.RAISE_TAB,signatureID:l,threadID:j,userAction:k});}};f.exports=i;},null);
__d('PagesMessengerThreadUtils',['invariant','MessagingTag','PageMessageEnumTag'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i='CUSTOM_TAG_',j={isFlagThread:function(k){if(k&&k.page_thread_info&&'flagged' in k.page_thread_info)return k.page_thread_info.flagged;return false;},isPageSpecficEnumFilter:function(k){if(k===c('PageMessageEnumTag').FLAG)return true;return false;},isCustomTagsFilter:function(k){return k.startsWith(i);},getCustomTagsFilter:function(k){return i+JSON.stringify(k.sort());},parseCustomTagsFilter:function(k){if(!this.isCustomTagsFilter(k))h(0);return JSON.parse(k.substring(i.length));},getBatchActionMenuParam:function(k){var l=false,m=false,n=false,o=false,p=false,q=false,r=false,s=false,t=false;if(k.folder===c('MessagingTag').INBOX&&!k.is_archived){l=true;o=true;if(j.isFlagThread(k)){r=true;}else q=true;if(k&&k.unread_count===0){t=true;}else s=true;}else if(k.folder===c('MessagingTag').SPAM){p=true;}else if(k.is_archived){m=true;n=true;}if(k&&k.unread_count===0){t=true;}else s=true;return {showArchive:l,showDelete:m,showUnarchive:n,showSpam:o,showUnspam:p,showFlag:q,showUnflag:r,showMarkRead:s,showMarkUnread:t,showHideContextCard:false,showShowContextCard:false};}};f.exports=j;},null);
__d('MercuryGiftSnippetRenderer',['fbt'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i={renderText:function(j,k){return j?h._("You sent a valentine."):h._("{name} sent a valentine.",[h.param('name',k)]);}};f.exports=i;},null);
__d('MercurySingletonProvider',['CurrentUser','Map'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i){this.$MercurySingletonProvider1=new (c('Map'))();this.$MercurySingletonProvider2=i;}h.prototype.getForFBID=function(i){if(!this.$MercurySingletonProvider1.has(i))this.$MercurySingletonProvider1.set(i,new this.$MercurySingletonProvider2(i));return this.$MercurySingletonProvider1.get(i);};h.prototype.get=function(){return this.getForFBID(c('CurrentUser').getID());};h.mock=function(i){throw new Error('MercurySingletonProvider.mock() must only be used in tests.');};f.exports=h;},null);
__d('MercurySyncDeltaTypes',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={AdminTextMessage:'AdminTextMessage',DeliveryReceipt:'DeliveryReceipt',ForcedFetch:'ForcedFetch',MarkRead:'MarkRead',MessageDelete:'MessageDelete',NewMessage:'NewMessage',ParticipantLeftGroupThread:'ParticipantLeftGroupThread',ParticipantsAddedToGroupThread:'ParticipantsAddedToGroupThread',ReadReceipt:'ReadReceipt',ReplaceMessage:'ReplaceMessage',RTCEventLog:'RTCEventLog',ThreadDelete:'ThreadDelete',ThreadName:'ThreadName'};f.exports=h;},null);
__d('ChatBehavior',['Arbiter','AvailableList','AvailableListConstants','ChatNotificationConstants'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=false,i=c('AvailableList').getWebChatNotification&&c('AvailableList').getWebChatNotification(),j=h,k=true,l=Object.assign(new (c('Arbiter'))(),{ON_CHANGED:'changed',notifiesUserMessages:function(){return i!==c('ChatNotificationConstants').NO_USER_MESSAGE_NOTIFICATION;},ignoresRemoteTabRaise:function(){return j;},showsTabUnreadUI:function(){return k;}});function m(){l.inform(l.ON_CHANGED);}c('AvailableList').subscribe&&c('AvailableList').subscribe(c('AvailableListConstants').ON_CHAT_NOTIFICATION_CHANGED,function(){var n=i,o=c('AvailableList').getWebChatNotification();i=o;if(n!=o)m();});c('Arbiter').subscribe('chat/set_does_page_occlude_tabs',function(n,o){j=!!o;m();});c('Arbiter').subscribe('chat/set_show_tab_unread_ui',function(n,o){k=!!o;m();});f.exports=l;},null);
__d('ChatCookieInterface',['ChatConfig','InitialServerTime','MercuryIDs','LogHistory','PresenceState','PresenceUtil'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('LogHistory').getInstance('chat_cookie'),i=c('InitialServerTime').serverTime,j=c('ChatConfig').get('tab_max_load_age')||3600000,k=i-j,l={store:function(p,q){if(p.uct2==q.lastChangeTime)return p;var r=o(p,q),s={};if(!r){s.old_tabs=p&&p.t2&&JSON.stringify(p.t2);s.old_promoted=p&&p.lm2;s.old_time=p&&p.uct2;s.old_reason=p&&p.tr;s.old_window=p&&p.tw;var t=[];q.tabs.forEach(function(u){if(!u.fragile||u.server_id){var v={i:u.fragile?c('MercuryIDs').getThreadIDFromThreadFBID(u.server_id):u.id,si:u.server_id};if(u.raised)v.r=1;t.push(v);}});p.t2=t;p.lm2=q.promotedID;p.uct2=q.lastChangeTime;p.tr=q.lastChangeReason;p.tw=c('PresenceUtil').getSessionID();h.debug('store','{}');}else h.warn('store_bad_state','{}');return p;},load:function(p,q){if(!p){h.warn('load_bad_state','{}');return false;}var r=o(p,q);if(!r||r===q.lastChangeTime)return false;q.lastChangeTime=r;q.lastChangeReason='load';var s=m(q,p.t2,p.lm2||null),event='load';if(!q.isInitialized)event+='_init';h.log(event,'{}');return s;},tabsChanged:function(){return n.apply(undefined,arguments);}};function m(p,q,r){var s;if(!n(p,q,r))return false;var t=p.tabs.filter(function(w){return !!w.fragile;}),u={};p.promotedID=null;p.tabs=q.map(function(w){var x={id:w.i,server_id:w.si};if(x.id==r)p.promotedID=x.id;if(w.r)x.raised=true;u[x.id]=x;return x;});p.tabs=p.tabs.filter(function(w){return !!w;});if(p.localRaised)for(var v in p.localRaised)if(!u[v]||!u[v].raised)delete p.localRaised[v];t=t.filter(function(w){return !u[w.id];});(s=p.tabs).push.apply(s,t);return true;}function n(p,q,r){if(r&&r!=p.promotedID)return true;var s=p.tabs.filter(function(v){return !v.fragile||v.server_id;});if(q.length!=s.length)return true;for(var t=0,u=q.length;t<u;t++)if(!!q[t].r!==s[t].raised||!q[t].si&&q[t].i!==s[t].id||q[t].si&&q[t].si!==s[t].server_id)return true;return false;}function o(p,q){var r=c('PresenceState').verifyNumber(p.uct2);if(!r||typeof r!=='number'){h.warn('bad_cookie_version','{}');return null;}if(r<q.lastChangeTime||r<k)return null;return r;}f.exports=l;},null);
__d('MercuryAssert',['MercuryIDs'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();f.exports={isParticipantID:function(h){if(!c('MercuryIDs').isValid(h))throw 'bad_participant_id '+h;},allParticipantIDs:function(h){h.forEach(this.isParticipantID);},isUserParticipantID:function(h){var i=c('MercuryIDs').tokenize(h);if(i.type!='fbid')throw 'bad_user_id '+h;},isEmailParticipantID:function(h){var i=c('MercuryIDs').tokenize(h);if(i.type!='email')throw 'bad_email_id '+h;},allThreadID:function(h){h.forEach(this.isThreadID);},isThreadID:function(h){if(!c('MercuryIDs').isValid(h))throw 'bad_thread_id '+h;}};},null);
__d('MercuryLocalIDs',['PresenceUtil','randomInt'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={generateMessageID:function(j){var k=j||Date.now(),l=c('randomInt')(0,4294967295),m=c('PresenceUtil').getSessionID();return '<'+k+':'+l+'-'+m+'@mail.projektitan.com>';},generateThreadID:function(j){return 'root:'+h.generateOfflineThreadingID(j);},generateOfflineThreadingID:function(j){var k=j||Date.now(),l=c('randomInt')(0,4294967295),m=('0000000000000000000000'+l.toString(2)).slice(-22),n=k.toString(2)+m;return i(n.slice(-63));}};function i(j){var k='';while(j!='0'){var l=0,m='';for(var n=0;n<j.length;n++){l=2*l+parseInt(j[n],10);if(l>=10){m+='1';l-=10;}else m+='0';}k=l.toString()+k;j=m.slice(m.indexOf('1'));}return k;}f.exports=h;},null);
__d('FBID',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={isUser:function(i){return i<2.2e+09||i>=1e+14&&i<=100099999989999||i>=8.9e+13&&i<=89999999999999||i>=6.000001e+13&&i<=60000019999999;}};f.exports=h;},null);
__d('MercuryServerRequestSingletonMixin',['CurrentUser','FBID'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={_getInstances:function(){if(!this._instances)this._instances={};return this._instances;},get:function(){return this.getForFBID(c('CurrentUser').getID());},getForFBID:function(i){var j=this._getInstances();if(!j[i])if(c('FBID').isUser(i)){j[i]=new this(i);}else{var k;e(['MercuryPageServerRequests'],function(l){k=new l(i);});j[i]=k;}return j[i];}};f.exports=h;},null);
__d('MercuryPageServerRequests',['MercuryAPIArgsSource','MercuryAssert','MercuryServerRequests','PageMessageEnumTag','PagesMessengerThreadUtils','MercuryServerDispatcher'],function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();var j=c('MercuryAPIArgsSource').MERCURY;h=babelHelpers.inherits(k,c('MercuryServerRequests'));i=h&&h.prototype;function k(l){'use strict';i.constructor.call(this,l);var m={'/pages/messaging/thread_tag/add/':{request_user_id:l,mode:c('MercuryServerDispatcher').BATCH_SUCCESSIVE,batch_function:this.$MercuryPageServerRequests1,handler:function(n,o){return this.__handleUpdate(n,o);}.bind(this)},'/pages/messaging/thread_tag/remove/':{request_user_id:l,mode:c('MercuryServerDispatcher').BATCH_SUCCESSIVE,batch_function:this.$MercuryPageServerRequests1,handler:function(n,o){return this.__handleUpdate(n,o);}.bind(this)},'/pages/messaging/thread_tag/list/':{request_user_id:l,mode:c('MercuryServerDispatcher').IMMEDIATE,handler:function(n,o){return this.__handleUpdate(n,o);}.bind(this)},'/pages/messaging/thread_custom_tags/list/':{request_user_id:l,mode:c('MercuryServerDispatcher').IMMEDIATE,handler:function(n,o){return this.__handleUpdate(n,o);}.bind(this)},'/pages/messaging/create_note/':{request_user_id:l,mode:c('MercuryServerDispatcher').IMMEDIATE,handler:function(n,o){return this.__handleUpdate(n,o);}.bind(this)}};c('MercuryServerDispatcher').registerEndpoints(m);}k.prototype.$MercuryPageServerRequests1=function(l,m){'use strict';var n=l?l.tag_name:m.tag_name,o=l?l.thread_ids:[],p=m?m.thread_ids:[],q=o.concat(p),r={tag_name:n,thread_ids:q};return r;};k.prototype.addThreadFlag=function(l,m){'use strict';c('MercuryAssert').isThreadID(l);this.__threadIDMap.getServerIDFromClientID(l,function(n){var o={thread_ids:[n],tag_name:c('PageMessageEnumTag').FLAG};this.__sendRequest('/pages/messaging/thread_tag/add/',o);}.bind(this));};k.prototype.createNote=function(l,m,n){'use strict';c('MercuryAssert').isThreadID(n);this.__threadIDMap.getServerIDFromClientID(n,function(o){var p={body:l,message_id:m,other_user_fbid:o};this.__sendRequest('/pages/messaging/create_note/',p);}.bind(this));};k.prototype.fetchThreadlistInfo=function(l,m,n,o,p){'use strict';var q={folder:n,offset:l,limit:m};if(c('PagesMessengerThreadUtils').isPageSpecficEnumFilter(o)){p=p||j;q.tag_name=o;this.__sendRequest('/pages/messaging/thread_tag/list/',q);return;}if(o&&c('PagesMessengerThreadUtils').isCustomTagsFilter(o)){q.custom_tags_filter=o;q.custom_tags=c('PagesMessengerThreadUtils').parseCustomTagsFilter(o);this.__sendRequest('/pages/messaging/thread_custom_tags/list/',q);return;}i.fetchThreadlistInfo.call(this,l,m,n,o,p);};k.prototype.removeThreadFlag=function(l,m){'use strict';c('MercuryAssert').isThreadID(l);this.__threadIDMap.getServerIDFromClientID(l,function(n){var o={thread_ids:[n],tag_name:c('PageMessageEnumTag').FLAG};this.__sendRequest('/pages/messaging/thread_tag/remove/',o);}.bind(this));};k.prototype.toString=function(){'use strict';return 'MercuryPageServerRequests';};f.exports=k;},null);
__d('EmojiLikeConstants',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={SMALL:'small',MEDIUM:'medium',LARGE:'large'},i='hot_emoji_size',j='emoji_like',k='\uD83D\uDC4D';f.exports={size:h,TAG_PREFIX_NEW:i,TAG_PREFIX_OLD:j,THUMBS_UP_EMOJI:k};},null);
__d('MercuryTagHelper',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={get:function(i,j){var k=i.find(function(l){return l.startsWith(j);});return k&&k.substr(k.indexOf(':')+1);}};f.exports=h;},null);
__d('EmojiLikeUtils',['EmoticonsList','EmojiLikeConstants','MercuryConfig','MercuryTagHelper','SupportedEmoji','Utf16'],function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();var j=c('EmojiLikeConstants').size,k='/images/emoji/unicode/emoji_',l='/images/emoticons/',m=(h={},h[j.SMALL]='_16-2x',h[j.MEDIUM]='_64',h[j.LARGE]='_64',h),n=(i={},i[j.MEDIUM]='-2x',i),o='.png',p='emoji',q='emoticon',r=new RegExp('([\u203C\u2049\u2100-\u21FF\u2300-\u27FF'+'\u2900-\u29FF\u2B00-\u2BFF\u3000-\u30FF\u3200-\u32FF]|'+'\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDEFF])([\uFE00-\uFE0F])?'),s=function(z){if(!c('MercuryConfig').BubblelessEmojiRenderingGK)return false;var aa=z||'',ba=[],ca=null;while(aa.length>0){aa=aa.trim();if(c('EmoticonsList').noncapturingRegexp.test(aa)){ca=c('EmoticonsList').noncapturingRegexp.exec(aa);ba.push({type:q,title:ca[1],id:c('EmoticonsList').emotes[ca[1]]});aa=aa.replace(c('EmoticonsList').noncapturingRegexp,'');}else if(r.test(aa)){var da=r.exec(aa);if(!da||!da.length)return false;ca=da[1];var ea=c('Utf16').decode(ca),fa=c('SupportedEmoji').emoji[ea];if(!fa)return false;ba.push({type:p,id:ea.toString(16)});aa=aa.replace(r,'');}else return false;}return ba;};function t(z,aa){z.tags=[u(aa)];return z;}function u(z){var aa=c('MercuryConfig').WWWMessengerNewEmojiSizeTagGK?c('EmojiLikeConstants').TAG_PREFIX_NEW:c('EmojiLikeConstants').TAG_PREFIX_OLD;return aa+':'+z;}function v(z){return w(z)!=null;}function w(z){if(!z.tags)return null;var aa=c('MercuryTagHelper').get(z.tags,c('EmojiLikeConstants').TAG_PREFIX_NEW);if(aa)return aa;return c('MercuryTagHelper').get(z.tags,c('EmojiLikeConstants').TAG_PREFIX_OLD);}function x(z,aa){if(!c('SupportedEmoji').findEmoji(z))return null;return (k+c('Utf16').decode(z).toString(16)+m[aa]+o);}function y(z){var aa=j.LARGE,ba=j.MEDIUM,ca=[];if(z)z.forEach(function(da){if(da.type===p){ca.push({type:da.type,title:undefined,url:k+da.id+m[aa]+o});}else ca.push({type:da.type,title:da.title,url:l+da.id+n[ba]+o});});return ca;}f.exports={getEmojiSize:w,getURI:x,getSourceURIs:y,isEmojiLike:v,richContent:s,setEmojiSize:t,EMOJI_TYPE:p,EMOTE_TYPE:q};},null);
__d('MercuryAttachment',['cx','EmojiLikeUtils','MercuryAttachmentContentType','MercuryAttachmentType','MercuryAudioType','MercuryTagHelper'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i={getAttachIconClass:function(j){switch(j){case c('MercuryAttachmentContentType').PHOTO:return "_y2-";case c('MercuryAttachmentContentType').VIDEO:return "_y2_";case c('MercuryAttachmentContentType').MUSIC:return "_y30";case c('MercuryAttachmentContentType').VOICE:return "_y31";case c('MercuryAttachmentContentType').TEXT:return "_y32";case c('MercuryAttachmentContentType').MSWORD:return "_y33";case c('MercuryAttachmentContentType').MSXLS:return "_y34";case c('MercuryAttachmentContentType').MSPPT:return "_y35";}return "_y36";},getAttachIconClassByMime:function(j){if(j.startsWith('image')){return "_y2-";}else if(j.startsWith('video')){return "_y2_";}else if(j.startsWith('audio')){return "_y30";}else if(j.startsWith('text/plain')){return "_y32";}else return "_y36";},getAttachTypeByMime:function(j){if(j.startsWith('image')){return c('MercuryAttachmentContentType').PHOTO;}else if(j.startsWith('video')){return c('MercuryAttachmentContentType').VIDEO;}else if(j.startsWith('audio')){return c('MercuryAttachmentContentType').MUSIC;}else if(j.startsWith('text/plain')){return c('MercuryAttachmentContentType').TEXT;}else return c('MercuryAttachmentContentType').UNKNOWN;},convertRaw:function(j){var k=[];for(var l=0;l<j.length;l++){var m=j[l];if(m.attach_type===c('MercuryAttachmentType').PHOTO){k.push(m);}else if(m.filename){var n=i.getAttachTypeByMime(m.filetype),o={};o.attach_type=c('MercuryAttachmentType').FILE;o.name=m.filename;o.icon_type=n;o.url='';k.push(o);}}return k;},get:function(j){var k=[];if(j.attachments){k=j.attachments;}else if(j.raw_attachments)k=this.convertRaw(j.raw_attachments);var l=c('EmojiLikeUtils').getEmojiSize(j);if(l)k=k.concat([{attach_type:c('MercuryAttachmentType').EMOJI_LIKE,size:l}]);if(!(j.attachments&&j.attachments.length>0)){if(j.sticker_id)return k.concat([{attach_type:c('MercuryAttachmentType').STICKER}]);if(j.preview_attachments&&j.preview_attachments.length>0)return k.concat(j.preview_attachments);}return k;},resizeContain:function(j,k){var l=j.width/j.height,m=k.width/k.height;if(m<l){return {width:Math.ceil(Math.min(j.height*m,k.width)),height:Math.ceil(Math.min(j.height,k.height))};}else return {width:Math.ceil(Math.min(j.width,k.width)),height:Math.ceil(Math.min(j.width/m,k.height))};},isBubblePreferred:function(j){return !(this.isPhotoAttachment(j)||this.isStickerAttachment(j)||this.isVideoAttachment(j)||this.isVoiceAttachment(j));},isEphemeralAttachmentStyle:function(j){return (this.isPhotoAttachment(j)||this.isVideoAttachment(j));},isEphemeralTextStyle:function(j){return (this.isErrorAttachment(j)||this.isShareAttachment(j)||this.isFileAttachment(j));},isPhotoAttachment:function(j){return !!(j.attach_type==c('MercuryAttachmentType').PHOTO||j.attach_type==c('MercuryAttachmentType').ANIMATED_IMAGE||j.attach_type==c('MercuryAttachmentType').FILE&&j.preview_url);},isVideoAttachment:function(j){return j.attach_type==c('MercuryAttachmentType').VIDEO;},isShareAttachment:function(j){return j.attach_type==c('MercuryAttachmentType').SHARE;},isFileAttachment:function(j){return j.attach_type==c('MercuryAttachmentType').FILE;},isErrorAttachment:function(j){return j.attach_type==c('MercuryAttachmentType').ERROR;},isStickerAttachment:function(j){return j.attach_type==c('MercuryAttachmentType').STICKER;},isEmojiLikeAttachment:function(j){return j.attach_type===c('MercuryAttachmentType').EMOJI_LIKE;},isVoiceAttachment:function(j){if(!j.metadata)return false;return (j.metadata.type===c('MercuryAudioType').AudioClip||j.metadata.type===c('MercuryAudioType').VoiceMessageWithTranscript);},hasAttribution:function(j){return !!j.app_attribution;}};f.exports=i;},null);
__d('MercurySingletonMixin',['CurrentUser'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={_getInstances:function(){if(!this._instances)this._instances={};return this._instances;},get:function(){return this.getForFBID(c('CurrentUser').getID());},getForFBID:function(i){var j=this._getInstances();if(!j[i])j[i]=new this(i);return j[i];}};f.exports=h;},null);
__d('MercuryThreadInformer',['ArbiterMixin','LogHistory','MercuryAssert','MercurySingletonMixin','mapObject','mixin'],function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();var j=c('LogHistory').getInstance('mercury_informer');h=babelHelpers.inherits(k,c('mixin')(c('ArbiterMixin')));i=h&&h.prototype;function k(l){i.constructor.call(this);this.$MercuryThreadInformer1=l;this.$MercuryThreadInformer2={};this.$MercuryThreadInformer3={};this.$MercuryThreadInformer4={};this.$MercuryThreadInformer5=false;this.$MercuryThreadInformer6=false;this.$MercuryThreadInformer7=false;this.$MercuryThreadInformer8={};this.$MercuryThreadInformer9={};this.$MercuryThreadInformer10={};this.$MercuryThreadInformer11=0;}k.prototype.updatedThread=function(l){this.$MercuryThreadInformer3[l]=true;this.$MercuryThreadInformer12();};k.prototype.deletedThread=function(l){this.$MercuryThreadInformer2[l]=true;this.$MercuryThreadInformer12();};k.prototype.updatedThreadlist=function(){this.$MercuryThreadInformer5=true;this.$MercuryThreadInformer12();};k.prototype.updatedUnseenState=function(){this.$MercuryThreadInformer6=true;this.$MercuryThreadInformer12();};k.prototype.updatedUnreadState=function(){this.$MercuryThreadInformer7=true;this.$MercuryThreadInformer12();};k.prototype.changedThreadReadState=function(l,m,n){if(!this.$MercuryThreadInformer4[l]||this.$MercuryThreadInformer4[l].timestamp<n)this.$MercuryThreadInformer4[l]={mark_as_read:m,timestamp:n};this.$MercuryThreadInformer12();};k.prototype.receivedMessage=function(l){c('MercuryAssert').isThreadID(l.thread_id);var m=l.thread_id;if(!this.$MercuryThreadInformer8[m])this.$MercuryThreadInformer8[m]=[];this.$MercuryThreadInformer8[m].push(l);this.updatedThread(m);};k.prototype.reorderedMessages=function(l,m){this.$MercuryThreadInformer9[l]={source:m};this.$MercuryThreadInformer12();};k.prototype.updatedMessage=function(l,m,n){if(!this.$MercuryThreadInformer10[l])this.$MercuryThreadInformer10[l]={};this.$MercuryThreadInformer10[l][m]={source:n};this.updatedThread(l);};k.prototype.synchronizeInforms=function(l){this.$MercuryThreadInformer11++;try{l();}catch(m){throw m;}finally{this.$MercuryThreadInformer11--;this.$MercuryThreadInformer12();}};k.prototype.listen=function(l,m){return this.subscribe('threads-updated',function(n,o){if(o[l])m(l);});};k.prototype.$MercuryThreadInformer12=function(){if(!this.$MercuryThreadInformer11){var l=this.$MercuryThreadInformer2,m=this.$MercuryThreadInformer3,n=this.$MercuryThreadInformer4,o=this.$MercuryThreadInformer5,p=this.$MercuryThreadInformer6,q=this.$MercuryThreadInformer7,r=this.$MercuryThreadInformer8,s=this.$MercuryThreadInformer9,t=this.$MercuryThreadInformer10;this.$MercuryThreadInformer2={};this.$MercuryThreadInformer3={};this.$MercuryThreadInformer4={};this.$MercuryThreadInformer5=false;this.$MercuryThreadInformer6=false;this.$MercuryThreadInformer7=false;this.$MercuryThreadInformer8={};this.$MercuryThreadInformer9={};this.$MercuryThreadInformer10={};var u=Object.keys(m);if(u.length||o)this.inform('threadlist-updated',u);if(u.length)this.$MercuryThreadInformer13('threads-updated',m);for(var v in n){this.$MercuryThreadInformer13('thread-read-changed',n);break;}for(v in l){this.$MercuryThreadInformer13('threads-deleted',l);break;}if(p)this.$MercuryThreadInformer13('unseen-updated',null);if(q)this.$MercuryThreadInformer13('unread-updated',null);for(v in r){this.$MercuryThreadInformer13('messages-received',r);break;}for(v in s){this.$MercuryThreadInformer13('messages-reordered',s);break;}for(v in t){this.$MercuryThreadInformer13('messages-updated',t);break;}}};k.prototype.$MercuryThreadInformer13=function(l,m){j.debug(l,'{}');this.inform(l,m);};Object.assign(k,c('MercurySingletonMixin'));f.exports=k;},null);
__d('MercuryDispatcher',['invariant','ArbiterMixin','LogHistory','MercuryLoggingHelper','MercuryPayloadSource','MercurySingletonProvider','MercuryThreadInformer','isEmpty','mixin'],function a(b,c,d,e,f,g,h){'use strict';var i,j;if(c.__markCompiled)c.__markCompiled();var k=c('LogHistory').getInstance('mercury_dispatcher');i=babelHelpers.inherits(l,c('mixin')(c('ArbiterMixin')));j=i&&i.prototype;l.getForFBID=function(n){return m.getForFBID(n);};l.get=function(){return m.get();};function l(n){j.constructor.call(this);this.$MercuryDispatcher1=n;}l.prototype.handleUpdate=function(n){this.$MercuryDispatcher2(n);!(!!n.from_client!==!!n.preprocessed)?h(0):undefined;delete n.preprocessed;if(!c('isEmpty')(n))c('MercuryThreadInformer').getForFBID(this.$MercuryDispatcher1).synchronizeInforms(function(){if(n.payload_source===c('MercuryPayloadSource').SERVER_INVALIDATE_GLOBAL_STATE)this.inform('invalidate-global-state',{});if(n.payload_source===c('MercuryPayloadSource').SERVER_INVALIDATE_THREAD_STATE){var o=n.threads&&n.threads.length>0&&n.threads[0]&&n.threads[0].thread_id;if(o)this.inform('invalidate-thread-state',o);}if(!n.from_client)this.inform('payload-preprocessed',n);this.inform('update-thread-ids',n.newlyAddedClientIDs||{});this.inform('update-participants',n);this.inform('update-threads',n);this.inform('update-unread',n);this.inform('update-threadlist',n);this.inform('update-pinned-threads',n);this.inform('update-messages',n);this.inform('update-unseen',n);this.inform('update-typing-state',n);this.inform('update-delivery',n);this.inform('update-roger',n.roger);this.inform('update-blocked-users',n);this.inform('model-update-completed',null);}.bind(this));};l.prototype.$MercuryDispatcher2=function(n){var o={actions:[],threads:[]};if(n){if(n.actions)o.actions=n.actions.map(function(r){return c('MercuryLoggingHelper').obfuscateMessage(r);});if(n.threads)o.threads=n.threads.map(function(r){return c('MercuryLoggingHelper').obfuscateThread(r);});}var p=Object.assign({},n,o),q=n.payload_source;if(q!==c('MercuryPayloadSource').CLIENT_CHANGE_READ_STATUS&&q!==c('MercuryPayloadSource').CLIENT_MARK_THREAD_SEEN)k.debug('update:'+q,JSON.stringify({from_client:n.from_client}));};var m=new (c('MercurySingletonProvider'))(l);f.exports=l;},null);
__d('MercurySendErrorLogger',['Banzai','BanzaiLogger'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('BanzaiLogger').create({retry:true}),i=c('Banzai').isEnabled('mercury_send_error_logging'),j={log:function(k){if(!i)return;var l={message_id:k.message_id,timestamp_client:Date.now(),error_type:k.error_data.type,error_code:k.error_data.code,error_description:k.error_data.description,is_transient:k.error_data.is_transient};h.log('MercurySendErrorLoggerConfig',l);}};f.exports=j;},null);
__d('MercuryServerPayloadPreprocessor',['invariant','CurrentEnvironment','MercuryIDs','MercuryConfig','MercuryActionStatus','MercuryActionType','MercuryAttachment','MercuryDispatcher','MercurySendErrorLogger','MercurySingletonMixin','MercuryThreadIDMap','StoryAttachmentStyle','URI'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();function i(j){this.$MercuryServerPayloadPreprocessor1=j;this.$MercuryServerPayloadPreprocessor2=c('MercuryThreadIDMap').getForFBID(this.$MercuryServerPayloadPreprocessor1);this.$MercuryServerPayloadPreprocessor3=c('MercuryDispatcher').getForFBID(this.$MercuryServerPayloadPreprocessor1);}i.prototype.handleUpdate=function(j){var k={};!!j.from_client?h(0):undefined;(j.threads||[]).forEach(function(ca){this.$MercuryServerPayloadPreprocessor4(ca,k);var da=this.$MercuryServerPayloadPreprocessor2.getServerIDFromClientIDNow(ca.thread_id);e(['MercuryServerRequests'],function(ea){var fa=ea.getForFBID(this.$MercuryServerPayloadPreprocessor1);fa.markThreadFetched(ca.thread_id);fa.markThreadFetched(da);fa.updateLastActionTimestamp(ca.timestamp);}.bind(this));}.bind(this));(j.ordered_threadlists||[]).forEach(function(ca){var da=ca.thread_fbids||[];da=da.concat(ca.other_user_fbids||[]);ca.thread_ids=da.map(function(ea){return this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(ea.toString());}.bind(this));}.bind(this));if(j.pinned_threads&&j.pinned_threads.thread_fbids)j.pinned_threads.thread_fbids=j.pinned_threads.thread_fbids.map(function(ca){return this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(ca);}.bind(this));if(j.delivery_receipts){var l={};for(var m=j.delivery_receipts,n=Array.isArray(m),o=0,m=n?m:m[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var p;if(n){if(o>=m.length)break;p=m[o++];}else{o=m.next();if(o.done)break;p=o.value;}var q=p,r=q.other_user_fbid?c('MercuryIDs').getThreadIDFromUserID(q.other_user_fbid):this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(q.thread_fbid);l[r]=q.time;}j.delivery_receipts=l;}j.actions=j.actions||[];j.actions.forEach(function(ca){if(ca.action_type===c('MercuryActionType').SEND_MESSAGE&&ca.status===c('MercuryActionStatus').ERROR)c('MercurySendErrorLogger').log(ca);var da=null,ea=null;if(ca.other_user_fbid){ea=c('MercuryIDs').getThreadIDFromUserID(ca.other_user_fbid);da=ca.other_user_fbid;}else if(ca.thread_fbid){ea=c('MercuryIDs').getThreadIDFromThreadFBID(ca.thread_fbid);da=ca.thread_fbid;}else if(ca.thread_id){ea=c('MercuryIDs').getThreadIDFromThreadFBID(ca.thread_id);da=ca.thread_id;}else if(ca.status&&ca.status!=c('MercuryActionStatus').SUCCESS&&ca.client_thread_id){ea=ca.client_thread_id;}else h(0);da=da&&da.toString();ca.thread_id=this.$MercuryServerPayloadPreprocessor2.hasClientIDForServerID(da)?this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(da):ea;if(ca.action_type==c('MercuryActionType').SEND_MESSAGE&&ca.client_thread_id&&da){ca.thread_id=ca.client_thread_id;this.$MercuryServerPayloadPreprocessor2.forceSetServerIDToClientID(da,ca.client_thread_id);k[da]=ca.client_thread_id;}!ca.thread_id?h(0):undefined;if(!j.payload_source||!j.payload_source.startsWith('server'))e(['MercuryServerRequests'],function(fa){fa.getForFBID(this.$MercuryServerPayloadPreprocessor1).updateLastActionTimestamp(ca.timestamp);}.bind(this));}.bind(this));this.$MercuryServerPayloadPreprocessor5(j);this.$MercuryServerPayloadPreprocessor6(j);if(j.end_of_history){var s=[];for(var t=0;t<j.end_of_history.length;t++){var u=j.end_of_history[t];if(u.type=='user'){s.push('user:'+u.fbid);}else if(u.type=='thread'&&this.$MercuryServerPayloadPreprocessor2.hasClientIDForServerID(u.fbid))s.push(this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(u.fbid));}j.end_of_history=s;}if(j.roger){var v={};for(var w in j.roger){var x=Object.keys(j.roger[w]),y;if(w){y=this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(w);}else if(x.length===1)y=c('MercuryIDs').getThreadIDFromUserID(x[0]);if(y){var z=j.roger[w];v[y]={};for(var aa in z)if(z.hasOwnProperty(aa)){var ba=c('MercuryIDs').getParticipantIDFromUserID(aa);v[y][ba]=z[aa];}}}j.roger=v;}j.newlyAddedClientIDs=k;j.preprocessed=true;this.$MercuryServerPayloadPreprocessor3.handleUpdate(j);};i.prototype.$MercuryServerPayloadPreprocessor4=function(j,k){var l=j.other_user_fbid?j.other_user_fbid:j.thread_fbid;!l?h(0):undefined;var m=this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(l);if(!m){m=j.other_user_fbid?c('MercuryIDs').getThreadIDFromUserID(j.other_user_fbid):c('MercuryIDs').getThreadIDFromThreadFBID(j.thread_fbid);this.$MercuryServerPayloadPreprocessor2.setServerIDToClientID(l,m);this.$MercuryServerPayloadPreprocessor2.setDeprecatedServerIDToClientID(j.thread_id,m);k[l]=m;}j.thread_id=m;};i.prototype.$MercuryServerPayloadPreprocessor5=function(j){j.actions.forEach(function(k){if(k.action_type===c('MercuryActionType').USER_GENERATED_MESSAGE){k.attachments=k.attachments||[];k.attachments.forEach(function(l){if(c('MercuryAttachment').isShareAttachment(l)&&c('CurrentEnvironment').messengerdotcom){var m=new (c('URI'))(l.share.uri);if(!m.getDomain())l.share.uri=m.setDomain('facebook.com').setSubdomain(c('URI').getRequestURI().getSubdomain()).setProtocol('https').toString();}});}});};i.prototype.$MercuryServerPayloadPreprocessor6=function(j){if(!c('MercuryConfig').MercuryGenieRendering)return;j.actions.forEach(function(k){if(k.action_type!==c('MercuryActionType').USER_GENERATED_MESSAGE)return;var l=k;if(!l.has_attachment||!l.attachments)return;for(var m=l.attachments.length-1;m>=0;m-=1){var n=l.attachments[m];if(!n.share||!n.share.style_list||n.share.style_list[0]!=c('StoryAttachmentStyle').GENIE_MESSAGE)continue;if(n.share.target.genie_id)l.author=c('MercuryIDs').getParticipantIDFromUserID(n.share.target.genie_id);if(n.share.target&&!n.share.target.attachment){l.attachments.splice(m,1);l.has_attachment=l.attachments.length>0;}}});};Object.assign(i,c('MercurySingletonMixin'));f.exports=i;},null);
__d('MercuryMessageClientState',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={DO_NOT_SEND_TO_SERVER:'do_not_send_to_server',SEND_TO_SERVER:'send_to_server'};f.exports=h;},null);
__d('MercuryMessageIDs',['KeyedCallbackManager'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=new (c('KeyedCallbackManager'))(),i={getServerIDs:function(j,k){var l=j.filter(function(n){return n.indexOf('id')===-1;}),m=function(n){var o=j.map(function(p){return n[p]?n[p]:p;});k(o);};return h.executeOrEnqueue(l,m);},addServerID:function(j,k){h.setResource(j,k);}};f.exports=i;},null);
__d("MercuryServerSendMessageQueueOptions",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i,j,k,l,m,n){"use strict";this.success_handler=i;this.error_handler=j;this.transport_error_handler=k;this.timeout_handler=l;this.timeout=m;this.connection_retries=n;}f.exports=h;},null);
__d('MercuryServerSendMessageQueueSimulatedError',['AsyncRequest','AsyncResponse'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=9999,i={create:function(j){var k=new (c('AsyncRequest'))(this.endpoint_uri).setData({message_batch:[j],client:this.client}),l=new (c('AsyncResponse'))(k,{});Object.assign(l,{error:h,silentError:false,transientError:true,request:k});return l;}};f.exports=i;},null);
__d('MercuryServerSendMessageQueue',['BanzaiODS','LogHistory','MercuryLoggingHelper','MercuryServerRequestsConfig','MercuryServerDispatcher','MercuryServerSendMessageQueueSimulatedError'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h='/ajax/mercury/send_messages.php',i=c('LogHistory').getInstance('mercury_server_send_message_queue');function j(k,l,m,n){'use strict';this.sender_id=k;this.queue_id=l;this.$MercuryServerSendMessageQueue1=m.success_handler;this.$MercuryServerSendMessageQueue2=m.error_handler;this.$MercuryServerSendMessageQueue3=m.transport_error_handler;this.$MercuryServerSendMessageQueue4=m.timeout_handler;this.client=n;var o=null;if(c('MercuryServerRequestsConfig').msgrRegion)o={name:'X-MSGR-Region',value:c('MercuryServerRequestsConfig').msgrRegion};var p={};p[h]={request_user_id:this.sender_id,endpoint_id:this.queue_id,mode:c('MercuryServerDispatcher').IMMEDIATE,customHeader:o,handler:this.handleSuccess.bind(this),error_handler:this.handleError.bind(this),transport_error_handler:this.handleTransportError.bind(this),timeout:m.timeout,timeout_handler:this.handleTimeout.bind(this),connection_retries:m.connection_retries};c('MercuryServerDispatcher').registerEndpoints(p);this.pending_message=null;this.queue=[];}j.prototype.enqueue=function(k){'use strict';this.queue.push(k);this.$MercuryServerSendMessageQueue5();};j.prototype.$MercuryServerSendMessageQueue5=function(){'use strict';if(this.pending_message||!this.queue.length){if(this.pending_message)this.$MercuryServerSendMessageQueue6();return;}this.pending_message=this.queue.shift();c('MercuryServerDispatcher').trySend(h,{message_batch:[this.pending_message],client:this.client},null,this.sender_id,this.queue_id);};j.prototype.$MercuryServerSendMessageQueue7=function(){'use strict';while(this.queue.length)this.$MercuryServerSendMessageQueue8(this.queue.shift());};j.prototype.$MercuryServerSendMessageQueue8=function(k){'use strict';this.$MercuryServerSendMessageQueue2(c('MercuryServerSendMessageQueueSimulatedError').create(k));i.error('mark_as_failed',JSON.stringify({fbid:this.sender_id,queue_id:this.queue_id,message:c('MercuryLoggingHelper').obfuscateMessage(k)}));};j.prototype.handleSuccess=function(k,l){'use strict';this.$MercuryServerSendMessageQueue1(k,l);this.pending_message=null;this.$MercuryServerSendMessageQueue5();};j.prototype.handleError=function(k){'use strict';this.$MercuryServerSendMessageQueue2(k);this.$MercuryServerSendMessageQueue7();this.pending_message=null;};j.prototype.handleTransportError=function(k){'use strict';this.$MercuryServerSendMessageQueue3(k);this.$MercuryServerSendMessageQueue7();this.pending_message=null;};j.prototype.handleTimeout=function(k){'use strict';this.$MercuryServerSendMessageQueue4(k);this.$MercuryServerSendMessageQueue7();this.pending_message=null;};j.prototype.$MercuryServerSendMessageQueue6=function(){'use strict';i.debug('maybe_send_next_pending_message',JSON.stringify({fbid:this.sender_id,queue_id:this.queue_id,pending_message:c('MercuryLoggingHelper').obfuscateMessage(this.pending_message),queue:this.queue.map(function(l){return c('MercuryLoggingHelper').obfuscateMessage(l);})}));var k='send_queue.delayed.queue_length.'+this.queue.length.toString();c('BanzaiODS').bumpEntityKey('chat.web',k);};f.exports=j;},null);
__d('MercuryServerSendMessageQueueRouter',['BanzaiODS','LogHistory','Map','MercuryServerSendMessageQueue','MercurySingletonMixin'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('LogHistory').getInstance('mercury_server_send_message_queue_router'),i='chat.web.send_queue_router';c('BanzaiODS').setEntitySample(i,.1);function j(k){'use strict';this.fbid=k;this.queues=new (c('Map'))();}j.prototype.enqueue=function(k,l,m,n){'use strict';if(!this.queues.has(k)){this.queues.set(k,new (c('MercuryServerSendMessageQueue'))(this.fbid,k,l,m));h.debug('added queue',JSON.stringify({fbid:this.fbid,queue_id:k}));c('BanzaiODS').bumpEntityKey(i,'new_queue');}this.queues.get(k).enqueue(n);};Object.assign(j,c('MercurySingletonMixin'));f.exports=j;},null);
__d('MercuryServerRequests',['errorCode','invariant','Arbiter','AsyncResponse','BanzaiODS','ChannelConstants','CurrentUser','LogHistory','MercuryActionStatus','MercuryActionType','MercuryAPIArgsSource','MercuryAssert','MercuryDispatcher','MercuryThreadIDMap','MercuryErrorType','MercuryGlobalActionType','MercuryIDs','MercuryLogMessageType','MercuryMessageClientState','MercuryPayloadSource','MercurySendErrorLogger','MercuryServerPayloadPreprocessor','MercuryServerRequestsConfig','MercuryServerSendMessageQueueRouter','MercuryServerRequestSingletonMixin','MercurySourceType','MercuryThreadlistConstants','MercuryMessageIDs','MessagingConfig','MessagingTag','MercuryServerDispatcher','MercuryServerSendMessageQueueOptions','createObjectFrom','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=c('LogHistory').getInstance('mercury_server'),k=c('MercuryAPIArgsSource').MERCURY,l=1000;function m(w){return w.getError()?'_'+w.getError():'';}function n(w,x){var y=babelHelpers['extends']({},w),z;if(x.threads){if(!y.threads)y.threads={};for(z in x.threads)y.threads[z]=Object.keys(c('createObjectFrom')((y.threads[z]||[]).concat(x.threads[z])));}if(x.messages){if(!y.messages)y.messages={};for(z in x.messages){if(!y.messages[z])y.messages[z]={};for(var aa in x.messages[z])if(y.messages[z][aa]){y.messages[z][aa]=r(y.messages[z][aa],x.messages[z][aa]);}else y.messages[z][aa]=x.messages[z][aa];}}y.client=w.client||x.client;return y;}function o(w,x){var y=Object.assign(c('createObjectFrom')(w.folders,true),c('createObjectFrom')(x.folders,true)),z=w.client||x.client;return {folders:Object.keys(y),client:z};}function p(w,x){for(var y in x)if(w[y]&&typeof w[y]==='object'){w[y]=r(w[y],x[y]);}else if(x[y]&&typeof x[y]==='object'){var z={};Object.assign(z,x[y]);w[y]=z;}return w;}function q(w,x){return x;}function r(w,x){var y=w.offset<x.offset?w.offset:x.offset,z=w.offset+w.limit,aa=x.offset+x.limit,ba=z>aa?z:aa,ca=ba-y,da=w.timestamp>x.timestamp?w.timestamp:x.timestamp;return {offset:y,limit:ca,timestamp:da};}function s(w,x){var y=w.client||x.client,z={ids:{},client:y};Object.assign(z.ids,w.ids,x.ids);return z;}function t(w,x){var y={},z,aa=w.client||x.client;delete w.client;delete x.client;for(z in w)Object.assign(y,c('createObjectFrom')(w[z],z));for(z in x)Object.assign(y,c('createObjectFrom')(x[z],z));var ba={client:aa};for(var ca in y){z=y[ca];if(!ba[z])ba[z]=[];ba[z].push(ca);}return ba;}function u(w,x){var y=w.client||x.client,z=c('createObjectFrom')(w.ids,true),aa=c('createObjectFrom')(x.ids,true),ba=Object.assign(z,aa);return {ids:Object.keys(ba),client:y};}function v(w){this._fbid=w;this._lastActionTimestamp=0;this._fetchingThreads={};this._sentMessagesTimestamp={};this.__threadIDMap=c('MercuryThreadIDMap').getForFBID(this._fbid);this._dispatcher=c('MercuryDispatcher').getForFBID(this._fbid);this._payloadPreprocessor=c('MercuryServerPayloadPreprocessor').getForFBID(this._fbid);this._sendMessageQueueOptions=new (c('MercuryServerSendMessageQueueOptions'))(function(x,y){return this.__handleUpdate(x,y);}.bind(this),function(x){return this._handleSendMessageError(x);}.bind(this),function(x){return this._handleSendMessageTransportError(x);}.bind(this),function(x){return this._handleSendMessageTimeout(x);}.bind(this),c('MercuryServerRequestsConfig').sendMessageTimeout,c('MessagingConfig').SEND_CONNECTION_RETRIES);this._registerEndpoints();}Object.assign(v.prototype,{fetchThreadlistInfo:function(w,x,y,z,aa){y=y||c('MessagingTag').INBOX;aa=aa||k;var ba=z?c('MercuryServerDispatcher').IMMEDIATE:null,ca={client:aa};ca[y]={offset:w,limit:x,filter:z};this.__sendRequest('/ajax/mercury/threadlist_info.php',ca,ba);},fetchPinnedThreads:function(){this.__sendRequest('/mercury/pinned_threads/',{});},fetchUnseenThreadIDs:function(w,x){x=x||k;this.fetchThreadlistInfo(c('MercuryThreadlistConstants').RECENT_THREAD_OFFSET,c('MercuryThreadlistConstants').JEWEL_THREAD_COUNT,w,null,x);},fetchUnreadThreadIDs:function(w,x){x=x||k;this.__sendRequest('/ajax/mercury/unread_threads.php',{folders:[w],client:x});},fetchMissedMessages:function(w,x,y){x=x||k;var z={last_action_timestamp:y||this._lastActionTimestamp,folders:w,client:x};setTimeout(function(){this.__sendRequest('/ajax/mercury/thread_sync.php',z);}.bind(this),l);},fetchThreadData:function(w,x){x=x||k;c('MercuryAssert').allThreadID(w);var y={threads:{},client:x},z=[],aa=[];w.forEach(function(ca){if(this._fetchingThreads[ca])return;this._fetchingThreads[ca]=true;var da=this.__threadIDMap.getServerIDFromClientIDNow(ca),ea=c('MercuryIDs').tokenize(ca);if(ea.type=='user'){z.push(ea.value);y.threads.user_ids=z;}else if(ea.type=='thread'){if(da){aa.push(da);}else aa.push(ea.value);y.threads.thread_fbids=aa;}else if(ea.type=='root'){if(da){aa.push(da);y.threads.thread_fbids=aa;}}else if(ea.type!='pending')throw new Error('Unknown thread type',ea);}.bind(this));this._dispatcher.inform("fetch-thread-data",y);for(var ba in y.threads){this.__sendRequest('/ajax/mercury/thread_info.php',y);break;}},ensureThreadIsFetched:function(w,x){x=x||k;if(!this.__threadIDMap.getClientIDFromServerIDNow(w)&&!this._fetchingThreads[w]){this._fetchingThreads[w]=true;this.__sendRequest('/ajax/mercury/thread_info.php',{threads:{thread_fbids:[w]},client:x});}},fetchThreadMessages:function(w,x,y,z,aa,ba){c('MercuryAssert').isThreadID(w);ba=ba||k;var ca,da,ea=c('MercuryIDs').tokenize(w),fa=this.__threadIDMap.getServerIDFromClientIDNow(w),ga=false;if(fa){ca=fa;da=ea.type=='user'?'user_ids':'thread_fbids';}else{ca=ea.value;switch(ea.type){case 'user':da='user_ids';ga=true;break;case 'thread':da='thread_fbids';break;}}var ha={messages:{},threads:{},client:ba};if(da){ha.messages[da]={};ha.messages[da][ca]={offset:x,timestamp:z,limit:y};if(ga)ha.threads[da]=[ca];this.__sendRequest('/ajax/mercury/thread_info.php',ha,aa);}else this.__threadIDMap.getServerIDFromClientID(w,function(ia){ha.messages.thread_fbids={};ha.messages.thread_fbids[ia]={offset:x,timestamp:z,limit:y};this.__sendRequest('/ajax/mercury/thread_info.php',ha,aa);}.bind(this));},handleThreadInfoError:function(w){var x=w.getRequest().getData(),y=[];if(x.messages){for(var z in x.messages.thread_fbids)y.push(this._createServerErrorLogMessage(this.__threadIDMap.getClientIDFromServerIDNow(z)));for(var aa in x.messages.user_ids)y.push(this._createServerErrorLogMessage('user:'+aa));for(var ba in x.messages.group_ids)y.push(this._createServerErrorLogMessage('group:'+ba));}if(y.length)this._dispatcher.handleUpdate({actions:y,from_client:true,payload_source:c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE});if(x.threads&&(x.threads.user_ids||x.threads.group_ids||x.threads.thread_ids)){var ca=5,da=true;if(!x.retry_count){x.retry_count=0;if(x.messages)delete x.messages;}else if(x.retry_count>=ca){da=false;(x.threads.thread_ids||[]).forEach(function(fa){if(fa in this._fetchingThreads)delete this._fetchingThreads[fa];}.bind(this));}if(da){var ea=Math.pow(2,x.retry_count)*1000;c('setTimeoutAcrossTransitions')(function(){j.log('retry_thread','{}');this.__sendRequest('/ajax/mercury/thread_info.php',x);}.bind(this),ea);x.retry_count++;}}},markFolderAsRead:function(w){this.__sendRequest('/ajax/mercury/mark_folder_as_read.php',{folder:w});var x=[{action_type:c('MercuryGlobalActionType').MARK_ALL_READ,action_id:null,folder:w}];this._dispatcher.handleUpdate({global_actions:x,from_client:true,payload_source:c('MercuryPayloadSource').CLIENT_CHANGE_READ_STATUS});},changeThreadReadStatus:function(w,x,y,z,aa,ba){var ca;c('MercuryAssert').isThreadID(w);this.__threadIDMap.getServerIDFromClientID(w,function(da){var ea={ids:(ca={},ca[da]=x,ca),source:y,watermarkTimestamp:z,titanOriginatedThreadId:aa,shouldSendReadReceipt:ba};this.__sendRequest('/ajax/mercury/change_read_status.php',ea);}.bind(this));},changeThreadArchivedStatus:function(w,x,y){c('MercuryAssert').isThreadID(w);this.__threadIDMap.getServerIDFromClientID(w,function(z){var aa={ids:{},source:y};aa.ids[z]=x;this.__sendRequest('/ajax/mercury/change_archived_status.php',aa);}.bind(this));},changeThreadFolder:function(w,x){c('MercuryAssert').isThreadID(w);this.__threadIDMap.getServerIDFromClientID(w,function(y){var z={};z[x]=[y];this.__sendRequest('/ajax/mercury/move_thread.php',z);}.bind(this));},changeMutingOnThread:function(w,x){c('MercuryAssert').isThreadID(w);this.__threadIDMap.getServerIDFromClientID(w,function(y){this.__sendRequest('/ajax/mercury/change_mute_thread.php',{thread_fbid:y,mute_settings:x,payload_source:k});}.bind(this));},markThreadSpam:function(w,x){c('MercuryAssert').isThreadID(w);this.__threadIDMap.getServerIDFromClientID(w,function(y){this.__sendRequest('/ajax/mercury/mark_spam.php',{id:y,source:x});}.bind(this));},unmarkThreadSpam:function(w,x){c('MercuryAssert').isThreadID(w);this.__threadIDMap.getServerIDFromClientID(w,function(y){this.__sendRequest('/ajax/mercury/unmark_spam.php',{id:y,source:x});}.bind(this));},deleteThread:function(w,x){c('MercuryAssert').isThreadID(w);this.__threadIDMap.getServerIDFromClientID(w,function(y){var z={ids:[y],source:x};this.__sendRequest('/ajax/mercury/delete_thread.php',z);}.bind(this));},unpinThread:function(w){c('MercuryAssert').isThreadID(w);this.__threadIDMap.getServerIDFromClientID(w,function(x){this.__sendRequest('/mercury/unpin_thread/',{id:x});}.bind(this));},deleteMessages:function(w,x){c('MercuryMessageIDs').getServerIDs(x||[],function(y){this.__sendRequest('/ajax/mercury/delete_messages.php',{message_ids:y});}.bind(this));},sendDeliveryReceipts:function(w,x){c('MercuryMessageIDs').getServerIDs(w||[],function(y){this.__sendRequest('/ajax/mercury/delivery_receipts.php',{message_ids:y,thread_ids:x});}.bind(this));},sendNewMessage:function(w,x){x=x||k;if(!w.offline_threading_id)c('BanzaiODS').bumpEntityKey('chat.web','missing_otid_on_send');if(w.client_state&&w.client_state!==c('MercuryMessageClientState').SEND_TO_SERVER)return;var y=c('MercuryIDs').tokenize(w.thread_id),z=y.type,aa=babelHelpers['extends']({},w);aa.thread_id=null;if(z=='user'){aa.other_user_fbid=y.value;this._sendNewMessageToServer(aa,x);}else if(z=='thread'){aa.thread_fbid=y.value;this._sendNewMessageToServer(aa,x);}else if(z=='root'&&y.value==aa.offline_threading_id){aa.client_thread_id=w.thread_id;this._sendNewMessageToServer(aa,x);}else{!c('MercuryIDs').isLocalThread(w.thread_id)?i(0):undefined;this.__threadIDMap.getServerIDFromClientID(w.thread_id,function(ba){aa.thread_fbid=ba;this._sendNewMessageToServer(aa,x);}.bind(this));}},_sendNewMessageToServer:function(w,x){c('Arbiter').inform(c('ChannelConstants').ATTEMPT_RECONNECT);this._sentMessagesTimestamp[w.message_id]=Date.now();c('MercuryServerSendMessageQueueRouter').getForFBID(this._fbid).enqueue(w.other_user_fbid||w.thread_fbid||w.client_thread_id,this._sendMessageQueueOptions,x,w);},markSeen:function(){var w=this._lastActionTimestamp;this.__sendRequest('/ajax/mercury/mark_seen.php',{seen_timestamp:w});},_handleSendMessageErrorCommon:function(w,x,y,z){j.debug('handle_send_message_error_common',JSON.stringify({reliability_error_status:y,request_error_status:x}));var aa=w.getData(),ba=aa.message_batch,ca=ba.map(function(ea){var fa={action_type:c('MercuryActionType').SEND_MESSAGE,other_user_fbid:ea.other_user_fbid,thread_fbid:ea.thread_fbid,client_message_id:ea.message_id,message_id:ea.message_id,client_thread_id:ea.client_thread_id,status:x,error_data:z};return fa;});ca.forEach(function(ea){if(ea.action_type===c('MercuryActionType').SEND_MESSAGE&&ea.status===c('MercuryActionStatus').ERROR)c('MercurySendErrorLogger').log(ea);},this);var da={actions:ca,payload_source:c('MercuryPayloadSource').CLIENT_HANDLE_ERROR};this._payloadPreprocessor.handleUpdate(da);},handleSendMessageError:function(w){var x=w.getPayload(),y=null,z=null;if(x&&x.error_payload){y=c('MercuryActionStatus').UNCONFIRMED;z='send_error';}else{y=c('MercuryActionStatus').ERROR;z='request_error'+m(w);}var aa=w.error;if(aa===1404102)c('AsyncResponse').verboseErrorHandler(w);var ba=/<.*>/.test(w.getErrorDescription())?w.getErrorSummary():w.getErrorDescription();this._handleSendMessageErrorCommon(w.getRequest(),y,z,{type:c('MercuryErrorType').SERVER,code:w.getError(),description:ba,is_transient:w.isTransient()});},handleSendMessageTransportError:function(w){this._handleSendMessageErrorCommon(w.getRequest(),c('MercuryActionStatus').ERROR,'transport_error'+m(w),{type:c('MercuryErrorType').TRANSPORT,code:w.getError(),is_transient:true});},handleSendMessageTimeout:function(w){this._handleSendMessageErrorCommon(w,c('MercuryActionStatus').ERROR,'transport_timeout',{type:c('MercuryErrorType').TIMEOUT,is_transient:true});},getLastActionTimestamp:function(){return this._lastActionTimestamp;},updateLastActionTimestamp:function(w){if(w)this._lastActionTimestamp=Math.max(this._lastActionTimestamp,w);},markThreadFetched:function(w){delete this._fetchingThreads[w];},_createServerErrorLogMessage:function(w){return {action_type:c('MercuryActionType').LOG_MESSAGE,thread_id:w,message_id:w,timestamp:Date.now(),timestamp_absolute:'',timestamp_relative:'',is_unread:false,source:c('MercurySourceType').UNKNOWN,log_message_type:c('MercuryLogMessageType').SERVER_ERROR,log_message_data:{}};},_getForAsyncRequest:function(w){var x=w.getData(),y=x.request_user_id?x.request_user_id:c('CurrentUser').getID();return v.getForFBID(y);},__handleUpdate:function(w,x){this._getForAsyncRequest(x)._payloadPreprocessor.handleUpdate(w);},_handleThreadInfoError:function(w){var x=this._getForAsyncRequest(w.getRequest());x.handleThreadInfoError(w);},_handleSendMessageError:function(w){var x=this._getForAsyncRequest(w.getRequest());x.handleSendMessageError(w);},_handleSendMessageTransportError:function(w){var x=this._getForAsyncRequest(w.getRequest());x.handleSendMessageTransportError(w);},_handleSendMessageTimeout:function(w){var x=this._getForAsyncRequest(w);x.handleSendMessageTimeout(w);},_registerEndpoints:function(){var w=null;if(c('MercuryServerRequestsConfig').msgrRegion)w={name:'X-MSGR-Region',value:c('MercuryServerRequestsConfig').msgrRegion};var x={'/ajax/mercury/thread_sync.php':{request_user_id:this._fbid,mode:c('MercuryServerDispatcher').IDEMPOTENT,customHeader:w,handler:function(y,z){return this.__handleUpdate(y,z);}.bind(this),connection_retries:3},'/ajax/mercury/thread_info.php':{request_user_id:this._fbid,mode:c('MercuryServerDispatcher').BATCH_DEFERRED_MULTI,customHeader:w,batch_function:n,handler:function(y,z){return this.__handleUpdate(y,z);}.bind(this),error_handler:function(y){return this._handleThreadInfoError(y);}.bind(this)},'/ajax/mercury/mark_folder_as_read.php':{request_user_id:this._fbid,mode:c('MercuryServerDispatcher').IMMEDIATE,customHeader:w,handler:function(y,z){return this.__handleUpdate(y,z);}.bind(this)},'/ajax/mercury/change_read_status.php':{request_user_id:this._fbid,mode:c('MercuryServerDispatcher').IMMEDIATE,customHeader:w,handler:function(y,z){return this.__handleUpdate(y,z);}.bind(this)},'/ajax/mercury/mark_seen.php':{request_user_id:this._fbid,mode:c('MercuryServerDispatcher').BATCH_SUCCESSIVE,customHeader:w,batch_function:q,handler:function(y,z){return this.__handleUpdate(y,z);}.bind(this)},'/ajax/mercury/threadlist_info.php':{request_user_id:this._fbid,mode:c('MercuryServerDispatcher').BATCH_SUCCESSIVE_UNIQUE,customHeader:w,batch_function:p,handler:function(y,z){return this.__handleUpdate(y,z);}.bind(this)},'/ajax/mercury/mark_spam.php':{request_user_id:this._fbid,mode:c('MercuryServerDispatcher').IMMEDIATE,customHeader:w,handler:function(y,z){return this.__handleUpdate(y,z);}.bind(this)},'/ajax/mercury/unmark_spam.php':{request_user_id:this._fbid,mode:c('MercuryServerDispatcher').IMMEDIATE,customHeader:w,handler:function(y,z){return this.__handleUpdate(y,z);}.bind(this)},'/ajax/mercury/unread_threads.php':{request_user_id:this._fbid,mode:c('MercuryServerDispatcher').BATCH_SUCCESSIVE_UNIQUE,customHeader:w,batch_function:o,handler:function(y,z){return this.__handleUpdate(y,z);}.bind(this)},'/ajax/chat/settings.php':{request_user_id:this._fbid,mode:c('MercuryServerDispatcher').IMMEDIATE,customHeader:w},'/ajax/mercury/change_archived_status.php':{request_user_id:this._fbid,mode:c('MercuryServerDispatcher').BATCH_SUCCESSIVE,customHeader:w,batch_function:s,handler:function(y,z){return this.__handleUpdate(y,z);}.bind(this)},'/ajax/mercury/delete_thread.php':{request_user_id:this._fbid,mode:c('MercuryServerDispatcher').BATCH_SUCCESSIVE,customHeader:w,batch_function:u,handler:function(y,z){return this.__handleUpdate(y,z);}.bind(this)},'/ajax/mercury/delete_messages.php':{request_user_id:this._fbid,mode:c('MercuryServerDispatcher').IMMEDIATE,customHeader:w,handler:function(y,z){return this.__handleUpdate(y,z);}.bind(this)},'/ajax/mercury/delivery_receipts.php':{request_user_id:this._fbid,mode:c('MercuryServerDispatcher').IMMEDIATE,customHeader:w,handler:function(y,z){return this.__handleUpdate(y,z);}.bind(this)},'/ajax/mercury/move_thread.php':{request_user_id:this._fbid,mode:c('MercuryServerDispatcher').BATCH_SUCCESSIVE,customHeader:w,batch_function:t,handler:function(y,z){return this.__handleUpdate(y,z);}.bind(this)},'/ajax/mercury/change_mute_thread.php':{request_user_id:this._fbid,mode:c('MercuryServerDispatcher').IMMEDIATE,customHeader:w,handler:function(y,z){return this.__handleUpdate(y,z);}.bind(this)},'/mercury/pinned_threads/':{request_user_id:this._fbid,mode:c('MercuryServerDispatcher').BATCH_SUCCESSIVE_UNIQUE,customHeader:w,handler:function(y,z){return this.__handleUpdate(y,z);}.bind(this)},'/mercury/unpin_thread/':{request_user_id:this._fbid,mode:c('MercuryServerDispatcher').IMMEDIATE,customHeader:w,handler:function(y,z){return this.__handleUpdate(y,z);}.bind(this)}};c('MercuryServerDispatcher').registerEndpoints(x);},__sendRequest:function(w,x,y){c('MercuryServerDispatcher').trySend(w,x,y,this._fbid);}});Object.assign(v,c('MercuryServerRequestSingletonMixin'));f.exports=v;},null);
__d('MercuryThreadIDMap',['KeyedCallbackManager','MercuryAssert','MercuryIDs','MercurySingletonProvider'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(j){this.$MercuryThreadIDMap1=j;this.$MercuryThreadIDMap2=new (c('KeyedCallbackManager'))();this.$MercuryThreadIDMap3=new (c('KeyedCallbackManager'))();}h.getForFBID=function(j){return i.getForFBID(j);};h.get=function(){return i.get();};h.prototype.setServerIDToClientID=function(j,k){var l=this.getClientIDFromServerIDNow(j);if(l){l!==k;return;}this.forceSetServerIDToClientID(j,k);};h.prototype.forceSetServerIDToClientID=function(j,k){this.$MercuryThreadIDMap2.setResource(j,k);this.$MercuryThreadIDMap3.setResource(k,j);};h.prototype.setDeprecatedServerIDToClientID=function(j,k){if(j)this.$MercuryThreadIDMap2.setResource(j,k);};h.prototype.getClientIDFromServerIDNow=function(j){return this.$MercuryThreadIDMap2.getResource(j);};h.prototype.getClientIDFromServerID=function(j,k){this.$MercuryThreadIDMap2.executeOrEnqueue(j,k);e(['MercuryServerRequests'],function(l){l.getForFBID(this.$MercuryThreadIDMap1).ensureThreadIsFetched(j);}.bind(this));};h.prototype.getServerIDFromClientIDNow=function(j){return this.$MercuryThreadIDMap3.getResource(j);};h.prototype.getServerIDFromClientID=function(j,k){c('MercuryAssert').isThreadID(j);var l=this.$MercuryThreadIDMap3.executeOrEnqueue(j,k);e(['MercuryServerRequests'],function(m){var n=this.$MercuryThreadIDMap3.getUnavailableResources(l),o=c('MercuryIDs').tokenize(j);if(n.length&&o.type!='root')m.getForFBID(this.$MercuryThreadIDMap1).fetchThreadData(n);}.bind(this));};h.prototype.hasClientIDForServerID=function(j){return !!this.getClientIDFromServerIDNow(j);};h.prototype.convertThreadIDIfAvailable=function(j){var k=this.getClientIDFromServerIDNow(j);return k||j;};h.prototype.canLinkExternally=function(j){c('MercuryAssert').isThreadID(j);var k=c('MercuryIDs').tokenize(j);return k.type=='user'||!!this.getServerIDFromClientIDNow(j);};var i=new (c('MercurySingletonProvider'))(h);f.exports=h;},null);
__d('MercuryDisplayTimeFilterMessageRenderer',['fbt'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i={renderFilteredContent:function(j){if(j.is_filtered_content_bh)return h._("This message was removed because it contains blocked or harmful links.");if(j.is_filtered_content_account)return h._("This message has been temporarily removed because the sender's account requires verification.");if(j.is_filtered_content_quasar)return h._("This message was removed because it contains blocked or harmful content.");if(j.is_filtered_content_invalid_app)return h._("This message was removed because the app it's being sent from is blocked from sending messages.");return h._("This message has been temporarily removed because the sender's account requires verification, or it was identified as abusive.");}};f.exports=i;},null);
__d('MercuryFolders',['MessagingTag'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=[c('MessagingTag').INBOX,c('MessagingTag').PENDING,c('MessagingTag').OTHER,c('MessagingTag').ACTION_ARCHIVED],i={getSupportedFolders:function(){return h.concat();},getFromMeta:function(j){var k=j.folder;if(j.is_archived)k=c('MessagingTag').ACTION_ARCHIVED;return k;}};f.exports=i;},null);
__d('ImageSourceType',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={PROFILE_PICTURE:'profile_picture',IMAGE:'image'};f.exports=h;},null);
__d('ImageSourceRequest',['CurrentUser','ImageSourceType','KeyedCallbackManager','PhotoResizeModeConst','MercuryServerDispatcher','arrayContains'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(){'use strict';this._request={fbid:null,type:null,width:null,height:null,resize_mode:null};this._callback=null;}h.prototype.setFBID=function(l){'use strict';this._request.fbid=l;return this;};h.prototype.setType=function(l){'use strict';if(!c('arrayContains')([c('ImageSourceType').PROFILE_PICTURE,c('ImageSourceType').IMAGE],l))throw new TypeError('ImageSourceRequest.setType: invalid type '+l);this._request.type=l;return this;};h.prototype.setDimensions=function(l,m){'use strict';this._request.width=l;this._request.height=m;return this;};h.prototype.setResizeMode=function(l){'use strict';if(!c('arrayContains')([c('PhotoResizeModeConst').COVER,c('PhotoResizeModeConst').CONTAIN],l))throw new TypeError('ImageSourceRequest.setResizeMode: invalid resize mode '+l);this._request.resize_mode=l;return this;};h.prototype.setCallback=function(l){'use strict';this._callback=l;return this;};h.prototype.send=function(){'use strict';if(!this._request.fbid||!this._request.width||!this._request.height||!this._request.type||!this._request.resize_mode||!this._callback)throw new Error('ImageSourceRequest: You must set all the fields');var l=j(),m=k(this._request);l.executeOrEnqueue(m,this._callback);if(l.getUnavailableResourcesFromRequest(m).length===1){c('MercuryServerDispatcher').trySend('/ajax/image_source.php',{requests:[this._request]});return true;}return false;};var i=null;function j(){if(i)return i;var l=new (c('KeyedCallbackManager'))();i=l;c('MercuryServerDispatcher').registerEndpoints({'/ajax/image_source.php':{request_user_id:c('CurrentUser').getID(),mode:c('MercuryServerDispatcher').BATCH_DEFERRED_MULTI,batch_function:function(m,n){var o;(o=m.requests).push.apply(o,n.requests);return m;},handler:function(m,n){var o=n.getData().requests;for(var p=0;p<o.length;++p)l.setResource(k(o[p]),m[p]);}}});return l;}function k(l){return [l.fbid,l.type,l.width,l.height,l.resize_mode].join('|');}f.exports=h;},null);
__d('MercuryParticipantFetcher',['LogHistory','MercuryIDs','MercuryPayloadSource','MercuryServerPayloadPreprocessor','Set','ShortProfiles','setImmediate'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('LogHistory').getInstance('short_profiles');function i(k){this.$MercuryParticipantFetcher4=c('MercuryServerPayloadPreprocessor').getForFBID(k);this.$MercuryParticipantFetcher1=false;this.$MercuryParticipantFetcher2=new (c('Set'))();this.$MercuryParticipantFetcher3=new (c('Set'))();}i.prototype.fetch=function(k){this.$MercuryParticipantFetcher5(k);this.$MercuryParticipantFetcher6();};i.prototype.fetchMulti=function(k){k.forEach(function(l){return this.$MercuryParticipantFetcher5(l);}.bind(this));this.$MercuryParticipantFetcher6();};i.prototype.$MercuryParticipantFetcher5=function(k){if(!this.$MercuryParticipantFetcher3.has(k))this.$MercuryParticipantFetcher2.add(k);};i.prototype.$MercuryParticipantFetcher6=function(){if(this.$MercuryParticipantFetcher1||this.$MercuryParticipantFetcher2.size===0)return;this.$MercuryParticipantFetcher1=true;c('setImmediate')(function(){this.$MercuryParticipantFetcher1=false;this.$MercuryParticipantFetcher2.forEach(function(k){return this.$MercuryParticipantFetcher3.add(k);}.bind(this));this.$MercuryParticipantFetcher7(this.$MercuryParticipantFetcher2,function(k){k.forEach(function(l){return this.$MercuryParticipantFetcher3['delete'](l.id);}.bind(this));this.$MercuryParticipantFetcher8(k);}.bind(this));this.$MercuryParticipantFetcher2.clear();}.bind(this));};i.prototype.$MercuryParticipantFetcher7=function(k,l){var m=[];k.forEach(function(n){var o=c('MercuryIDs').tokenize(n),p=o.type,q=o.value;p==='fbid'&&m.push(q);});if(m.length>0){c('ShortProfiles').getMulti(m,function(n){var o=[];for(var p in n)o.push(j(n[p],p));l(o);if(o.length!==m.length)h.error('server_fetch_participant_count_error',JSON.stringify({expectedIDs:m,receivedIDs:Object.keys(n)}));});h.debug('client_fetch_participants',JSON.stringify({userIDs:m}));}};i.prototype.$MercuryParticipantFetcher8=function(k){this.$MercuryParticipantFetcher4.handleUpdate({participants:k,from_client:false,payload_source:c('MercuryPayloadSource').SERVER_FETCH_PARTICIPANTS});};function j(k,l){var m=babelHelpers['extends']({gender:k.gender,fbid:k.id||l,href:k.uri,id:c('MercuryIDs').getParticipantIDFromUserID(k.id||l),image_src:k.thumbSrc,name:k.name,short_name:k.firstName,employee:k.employee,is_employee_away:k.is_employee_away,type:k.type,vanity:k.vanity,is_friend:k.is_friend,is_messenger_user:k.is_messenger_user,social_snippets:k.social_snippets,is_anonymous_crisis_support:k.isAnonymousCrisisSupport},{});if(k.officeStatus){m.officeStatus=k.officeStatus;m.officeStatusStartDate=k.officeStatusStartDate;m.officeStatusEndDate=k.officeStatusEndDate;m.officeStatusComment=k.officeStatusComment;m.officeStatusLocation=k.officeStatusLocation;}return m;}f.exports=i;},null);
__d('MercuryVanityIDMap',['Map','MercuryAssert'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=new (c('Map'))(),i=new (c('Map'))(),j={getID:function(k){return h.get(k);},getVanity:function(k){return i.get(k);},hasID:function(k){return i.has(k);},hasVanity:function(k){return h.has(k);},set:function(k,l){c('MercuryAssert').isParticipantID(l);h.set(k,l);i.set(l,k);}};f.exports=j;},null);
__d('MercuryParticipants',['fbt','CurrentUser','EventEmitter','ImageSourceRequest','ImageSourceType','ImmutableObject','KeyedCallbackManager','MercuryAssert','MercuryIDs','MercuryParticipantFetcher','MercuryParticipantTypes','MercuryParticipantsConstants','MercuryDispatcher','MercuryVanityIDMap','PhotoResizeModeConst','Set','createObjectFrom'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i='change';function j(l){this.$MercuryParticipants1=l;this.$MercuryParticipants2=new (c('EventEmitter'))();this.$MercuryParticipants3=new (c('KeyedCallbackManager'))();this.$MercuryParticipants4=new (c('MercuryParticipantFetcher'))(this.$MercuryParticipants1);this.$MercuryParticipants5=c('MercuryDispatcher').getForFBID(this.$MercuryParticipants1);this.$MercuryParticipants5.subscribe('update-participants',function(m,n){if(n.participants&&n.participants.length>0)this.$MercuryParticipants6(n.participants);}.bind(this));this.$MercuryParticipants5.subscribe('invalidate-global-state',function(){this.$MercuryParticipants7();}.bind(this));}j.prototype.addListener=function(l,m){return this.$MercuryParticipants2.addListener(l,m);};j.prototype.getIDFromVanityOrFBID=function(l){if(!l)return null;if(c('MercuryVanityIDMap').hasVanity(l))return c('MercuryVanityIDMap').getID(l);if(/^\d+$/.test(l))return c('MercuryIDs').getParticipantIDFromUserID(l);};j.prototype.getNow=function(l){return this.$MercuryParticipants8(l);};j.prototype.getOrFetch=function(l){var m=this.$MercuryParticipants8(l);if(!m)this.$MercuryParticipants4.fetch(l);return m;};j.prototype.get=function(l,m){c('MercuryAssert').isParticipantID(l);return this.$MercuryParticipants9([l],function(n){m(n[l]);});};j.prototype.getMulti=function(l,m){return this.$MercuryParticipants9(l,m);};j.prototype.getBigImageMulti=function(l,m){c('MercuryAssert').allParticipantIDs(l);var n=c('MercuryParticipantsConstants').BIG_IMAGE_SIZE;return this.$MercuryParticipants9(l,function(o){var p={},q=0,r=new (c('Set'))(),s=function(w,x){q++;p[w]=x;if(q===l.length){m(p);if(r.size>0)this.$MercuryParticipants10(r);}}.bind(this),t=function(w,x){this.$MercuryParticipants3.setResource(w,c('ImmutableObject').set(this.$MercuryParticipants3.getResource(w),{big_image_src:x.uri}));r.add(w);s(w,x.uri);}.bind(this);for(var u in o){var v=o[u];if(!v.big_image_src){new (c('ImageSourceRequest'))().setFBID(c('MercuryIDs').getUserIDFromParticipantID(u)).setType(c('ImageSourceType').PROFILE_PICTURE).setDimensions(n,n).setResizeMode(c('PhotoResizeModeConst').COVER).setCallback(t.bind(null,u)).send();}else s(v.id,v.big_image_src);}}.bind(this));};j.prototype.getOrderedBigImageMulti=function(l,m){return this.getBigImageMulti(l,function(n){m(l.map(function(o){return n[o];}));});};j.prototype.$MercuryParticipants9=function(l,m){c('MercuryAssert').allParticipantIDs(l);var n=this.$MercuryParticipants3.executeOrEnqueue(l,m),o=this.$MercuryParticipants3.getUnavailableResources(n).filter(function(p){var q=c('MercuryIDs').tokenize(p),r=q.type,s=q.value;if(r==='email'){this.$MercuryParticipants11(p,s);return false;}if(r==='name'){this.$MercuryParticipants12(p,s);return false;}return true;}.bind(this));this.$MercuryParticipants4.fetchMulti(o);return this.$MercuryParticipants13(n);};j.prototype.$MercuryParticipants8=function(l){var m=this.$MercuryParticipants3.getResource(l);if(!m){var n=c('MercuryIDs').tokenize(l),o=n.type,p=n.value;if(o==='email')m=this.$MercuryParticipants11(l,p);if(o==='name')m=this.$MercuryParticipants12(l,p);}return m;};j.prototype.$MercuryParticipants11=function(l,m){var n=new (c('ImmutableObject'))(k(l,m));this.$MercuryParticipants3.setResource(l,n);return n;};j.prototype.$MercuryParticipants12=function(l,m){var n=new (c('ImmutableObject'))({gender:c('MercuryParticipantsConstants').UNKNOWN_GENDER,href:null,id:l,image_src:c('MercuryParticipantsConstants').EMAIL_IMAGE,big_image_src:c('MercuryParticipantsConstants').EMAIL_IMAGE,name:m,short_name:m,employee:false});this.$MercuryParticipants3.setResource(l,n);return n;};j.prototype.$MercuryParticipants10=function(l){this.$MercuryParticipants2.emit(i,l);};j.prototype.$MercuryParticipants6=function(l){var m=l.map(function(n){return n.id;});l=l.map(function(n){if(n.vanity)c('MercuryVanityIDMap').set(n.vanity,n.id);var o=this.$MercuryParticipants3.getResource(n.id);return o?c('ImmutableObject').set(o,n):new (c('ImmutableObject'))(this.$MercuryParticipants14(n));}.bind(this));this.$MercuryParticipants3.addResourcesAndExecute(c('createObjectFrom')(m,l));this.$MercuryParticipants10(new (c('Set'))(m));};j.prototype.$MercuryParticipants14=function(l){var m=l.type===c('MercuryParticipantTypes').USER||l.type===c('MercuryParticipantTypes').FRIEND;if(!m)return l;if(!l.name&&!l.href&&!l.vanity){var n=h._("Facebook User");l.name=n;l.short_name=n;}return l;};j.prototype.$MercuryParticipants13=function(l){return {remove:function(){this.$MercuryParticipants3.unsubscribe(l);}.bind(this)};};j.prototype.$MercuryParticipants7=function(){this.$MercuryParticipants3=new (c('KeyedCallbackManager'))();};function k(l,m){return {gender:c('MercuryParticipantsConstants').UNKNOWN_GENDER,href:null,id:l,image_src:c('MercuryParticipantsConstants').EMAIL_IMAGE,big_image_src:c('MercuryParticipantsConstants').EMAIL_IMAGE,name:m,short_name:m,employee:false};}f.exports=new j(c('CurrentUser').getID());},null);
__d('MercurySyncFakeDFFSender',['Arbiter','ChannelConstants','MercurySyncDeltaTypes'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('ChannelConstants').getArbiterType(c('ChannelConstants').FAKE_DFF);function i(){c('Arbiter').inform(h,{obj:{delta:{'class':c('MercurySyncDeltaTypes').ForcedFetch}}});}function j(k,l){c('Arbiter').inform(h,{obj:{delta:{'class':c('MercurySyncDeltaTypes').ForcedFetch,threadKey:{otherUserFbId:k,threadFbId:l}}}});}f.exports={sendGlobalDFF:i,sendThreadDFF:j};},null);
__d('MercuryThreadInfo',['CurrentUser','MercuryIDs'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={canReply:function(j){return !!(j.is_subscribed&&(j.can_reply===undefined||j.can_reply)&&!j.has_email_participant&&!j.read_only&&(j.recipients_loadable||j.recipients_loadable===undefined));},getMuteSetting:function(j){return (j.mute_settings&&j.mute_settings[i(c('CurrentUser').getID())]);},isEmptyLocalThread:function(j){return (c('MercuryIDs').tokenize(j.thread_id).type==='root'&&!j.timestamp);},isMuted:function(j){return h.getMuteSetting(j)!==undefined;},isNewEmptyLocalThread:function(j){return !!(h.isEmptyLocalThread(j)&&j.participants&&j.participants.length===0);},showComposer:function(j){return !!(j.is_subscribed&&(j.composer_enabled===undefined||j.composer_enabled)&&!j.has_email_participant&&!j.read_only&&(j.recipients_loadable||j.recipients_loadable===undefined));}};function i(j){return j+'@facebook.com';}f.exports=h;},null);
__d('MessagingGiftWrapConstants',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h='gift_wrap',i='gift_unwrapped',j='valentines2016';f.exports={TAG_PREFIX:h,UNWRAPPED_TAG:i,VALENTINES_GIFT:j};},null);
__d('MessagingGiftWrapChecker',['MercuryConfig','MercuryTagHelper','MessagingGiftWrapConstants'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={shouldRenderWithGiftWrap:function(k){return !!(c('MercuryConfig').GiftWrapViewerGK&&k.tags&&i(k.tags)&&!j(k.tags));}};function i(k){return c('MercuryTagHelper').get(k,c('MessagingGiftWrapConstants').TAG_PREFIX)===c('MessagingGiftWrapConstants').VALENTINES_GIFT;}function j(k){return !!c('MercuryTagHelper').get(k,c('MessagingGiftWrapConstants').UNWRAPPED_TAG);}f.exports=h;},null);
__d('MercuryThreads',['AsyncRequest','EventEmitter','MercuryDisplayTimeFilterMessageRenderer','ImmutableObject','KeyedCallbackManager','LogHistory','Map','MercuryAPIArgsSource','MercuryActionType','MercuryAssert','MercuryAttachment','MercuryConfig','MercuryDispatcher','MercuryFolders','MercuryGiftSnippetRenderer','MercuryGlobalActionType','MercuryIDs','MercuryLogMessageType','MercuryLoggingHelper','MercuryParticipants','MercuryPayloadSource','MercuryServerRequests','MercurySingletonProvider','MercurySyncFakeDFFSender','MercuryThreadInfo','MercuryThreadInformer','MessagingGenericAdminTextType','MessagingGiftWrapChecker','MessagingTag','Set','XMercuryFBLoggerController','emptyFunction','ifRequired','requireWeak','setImmediate'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=new (c('EventEmitter'))(),i=c('LogHistory').getInstance('mercury_threads');function j(l){this.$MercuryThreads1=l;this.$MercuryThreads2=c('MercuryServerRequests').getForFBID(this.$MercuryThreads1);this.$MercuryThreads3=c('MercuryThreadInformer').getForFBID(this.$MercuryThreads1);this.$MercuryThreads4=c('MercuryIDs').getParticipantIDFromUserID(this.$MercuryThreads1);this.$MercuryThreads5=c('MercuryDispatcher').getForFBID(this.$MercuryThreads1);this.$MercuryThreads6=false;this.$MercuryThreads7=new (c('KeyedCallbackManager'))();this.$MercuryThreads8=new (c('Set'))();this.$MercuryThreads9=false;this.$MercuryThreads10=new (c('Set'))();this.$MercuryThreads11=new (c('Set'))();this.$MercuryThreads12();}j.getForFBID=function(l){return k.getForFBID(l);};j.get=function(){return k.get();};j.prototype.getThreadMetaNow=function(l){c('MercuryAssert').isThreadID(l);return this.$MercuryThreads7.getResource(l);};j.prototype.getOrFetch=function(l){var m=this.getThreadMetaNow(l);if(!m&&!this.$MercuryThreads11.has(l))this.$MercuryThreads10.add(l);if(this.$MercuryThreads10.size>0&&!this.$MercuryThreads9)this.$MercuryThreads13();return m;};j.prototype.getAllLoadedClientThreadIDs=function(){return Object.keys(this.$MercuryThreads7.getAllResources());};j.prototype.$MercuryThreads13=function(){if(this.$MercuryThreads9)return;this.$MercuryThreads9=true;c('setImmediate')(function(){this.$MercuryThreads9=false;this.$MercuryThreads10.forEach(function(l){return this.$MercuryThreads11.add(l);}.bind(this));this.getMultiThreadMeta(Array.from(this.$MercuryThreads10),function(l){for(var m in l)l.hasOwnProperty(m)&&this.$MercuryThreads11['delete'](m);}.bind(this));this.$MercuryThreads10.clear();}.bind(this));};j.prototype.getThreadMeta=function(l,m,n){return this.getMultiThreadMeta([l],function(o){return m(o[l]);},n);};j.prototype.getMultiThreadMeta=function(l,m,n){c('MercuryAssert').allThreadID(l);var o=this.$MercuryThreads7.executeOrEnqueue(l,m),p=this.$MercuryThreads7.getUnavailableResources(o);if(p.length){var q=[];for(var r=0;r<p.length;r++){var s=p[r],t=c('MercuryIDs').tokenize(s),u=t.type,v=t.value;if(u=='user'){var w=c('MercuryIDs').getParticipantIDFromUserID(v);this.createNewLocalThread(s,w===this.$MercuryThreads4?[this.$MercuryThreads4]:[this.$MercuryThreads4,w]);}else q.push(s);}if(q.length)this.$MercuryThreads2.fetchThreadData(q,n);}return o;};j.addListener=function(l,m){return h.addListener(l,m);};j.prototype.unsubscribe=function(l){this.$MercuryThreads7.unsubscribe(l);};j.prototype.getCanonicalThreadToParticipant=function(l,m,n,o){var p=c('MercuryIDs').getThreadIDFromParticipantID(l),q=this.$MercuryThreads7.getResource(p);if(typeof q=='undefined'){q=this.createNewLocalThread(p,this.$MercuryThreads4===l?[this.$MercuryThreads4]:[this.$MercuryThreads4,l],m);!o&&this.$MercuryThreads2.fetchThreadData([p],n);}return q;};j.prototype.createNewLocalThread=function(l,m,n){var o=this.$MercuryThreads7.getResource(l);if(!o){var p=c('MercuryIDs').tokenize(l),q=p.type,r=p.value;o=new (c('ImmutableObject'))({thread_id:l,participants:Array.from(m),name:'',snippet:'',snippet_has_attachment:false,snippet_sender:null,unread_count:n?n:0,message_count:0,image_src:null,timestamp_absolute:null,timestamp_relative:null,timestamp:null,other_user_fbid:q==='user'?r:null,is_canonical_user:q=='user',is_canonical:this.$MercuryThreads14(m),is_subscribed:true,folder:c('MessagingTag').INBOX,is_archived:false});this.$MercuryThreads7.setResource(l,o);}return o;};j.prototype.isEmptyLocalThread=function(l){var m=this.$MercuryThreads7.getResource(l);if(!m)return false;return c('MercuryThreadInfo').isEmptyLocalThread(m);};j.prototype.isNewEmptyLocalThread=function(l){var m=this.$MercuryThreads7.getResource(l);if(!m)return false;return c('MercuryThreadInfo').isNewEmptyLocalThread(m);};j.prototype.$MercuryThreads15=function(l,m){if(!l||!l.length)return;var n=new (c('Map'))(),o=new (c('Map'))(),p=new (c('Map'))(),q=[];for(var r=0;r<l.length;r++){var s=l[r];if(s.is_forward)continue;var t=s.action_type;if(t==c('MercuryActionType').LOG_MESSAGE&&s.log_message_type==c('MercuryLogMessageType').SERVER_ERROR)continue;var u=!!(s.sync_id||s.action_id||s.is_from_iris),v=s.thread_id;c('MercuryAssert').isThreadID(v);var w=this.$MercuryThreads7.getResource(v);if(!w&&!u&&t==c('MercuryActionType').USER_GENERATED_MESSAGE){w=this.$MercuryThreads16(s);if(w.participants){this.$MercuryThreads7.setResource(v,w);}else if(c('MercuryConfig').MercuryLogFromJSToFBLogger){var x='local_meta_'+JSON.stringify(s),y=c('XMercuryFBLoggerController').getURIBuilder().setString('message',x).getURI();new (c('AsyncRequest'))().setURI(y).send();i.debug('missing_local_participants',s);}}if(!w)continue;if(t==c('MercuryActionType').LOG_MESSAGE||t==c('MercuryActionType').USER_GENERATED_MESSAGE)u=!m;if(w.server_timestamp&&s.timestamp<=w.server_timestamp&&u)continue;if(!p.has(v))p.set(v,babelHelpers['extends']({},w));this.$MercuryThreads17(p.get(v),s,m);if(t==c('MercuryActionType').USER_GENERATED_MESSAGE)n.set(v,s);if(t==c('MercuryActionType').USER_GENERATED_MESSAGE||t==c('MercuryActionType').LOG_MESSAGE||t==c('MercuryActionType').SEND_MESSAGE){if(t==c('MercuryActionType').SEND_MESSAGE&&c('MercuryConfig').WWWDontUpdateTimestampOnSendGK)continue;if(s&&s.timestamp&&(!o.has(v)||s.timestamp>o.get(v).timestamp))o.set(v,s);}}p.forEach(function(z,aa){var ba=o.get(aa),ca=n.get(aa);if(ca){this.$MercuryThreads18(z,ca);}else if(ba&&ba.log_message_body){var da=babelHelpers['extends']({},ba,{body:ba.log_message_body});this.$MercuryThreads18(z,da);}var ea=z.timestamp;if(ba){if(ba.timestamp>ea)Object.assign(z,{timestamp_absolute:ba.timestamp_absolute,timestamp_relative:ba.timestamp_relative,timestamp:ba.timestamp});var fa=z.server_timestamp;if(!m&&ba.timestamp>fa)z.server_timestamp=ba.timestamp;}var ga=new (c('ImmutableObject'))(z);this.$MercuryThreads7.setResource(aa,ga);q.push(c('MercuryLoggingHelper').obfuscateThread(ga));}.bind(this),this);q.length&&this.$MercuryThreads6&&i.debug('threads_updated',JSON.stringify({threads:q}));};j.prototype.$MercuryThreads17=function(l,m,n){var o=m.action_type;if(o==c('MercuryActionType').USER_GENERATED_MESSAGE||o==c('MercuryActionType').LOG_MESSAGE){m.is_unread&&l.unread_count++;l.message_count++;l.is_archived=false;}switch(o){case c('MercuryActionType').DELETE_THREAD:l.message_count=0;this.$MercuryThreads19(m.thread_id);break;case c('MercuryActionType').USER_GENERATED_MESSAGE:if(l.unread_count===0&&m.author===this.$MercuryThreads4&&m.timestamp>=l.last_read_timestamp)l.last_read_timestamp=m.timestamp;if(m.offline_threading_id!==m.message_id)l.last_message_timestamp=m.timestamp;this.$MercuryThreads20(l,m.author);break;case c('MercuryActionType').SEND_MESSAGE:var p=m.log_message_type;if(p==c('MercuryLogMessageType').THREAD_IMAGE){l.image_src=m.log_message_data.image?m.log_message_data.image.preview_url:null;this.$MercuryThreads21(m.thread_id);}if(p!==c('MercuryLogMessageType').SUBSCRIBE&&p!==c('MercuryLogMessageType').UNSUBSCRIBE)l.snippet_attachments=m.attachments;break;case c('MercuryActionType').LOG_MESSAGE:var p=m.log_message_type;if(p==c('MercuryLogMessageType').SUBSCRIBE){this.$MercuryThreads22(l,m.log_message_data.added_participants);this.$MercuryThreads21(m.thread_id);}else if(p==c('MercuryLogMessageType').UNSUBSCRIBE){this.$MercuryThreads23(l,m.log_message_data.removed_participants);this.$MercuryThreads21(m.thread_id);}else if(p==c('MercuryLogMessageType').THREAD_IMAGE){if(!n)l.image_src=m.log_message_data.image?m.log_message_data.image.preview_url:null;}else if(p==c('MercuryLogMessageType').THREAD_NAME){if(l.name!==m.log_message_data.name)this.$MercuryThreads21(m.thread_id);l.name=m.log_message_data.name;}else if(p===c('MercuryLogMessageType').GENERIC_ADMIN_TEXT)this.$MercuryThreads24(l,m);break;case c('MercuryActionType').CHANGE_READ_STATUS:var q=this.$MercuryThreads25(l,m,m.mark_as_read);if(q)l.last_read_timestamp=l.last_message_timestamp;var r=!l.read_only&&l.folder===c('MessagingTag').INBOX;if(q&&n)this.$MercuryThreads2.changeThreadReadStatus(l.thread_id,m.mark_as_read,m.source,l.last_read_timestamp,l.titan_originated_thread_id,r);break;case c('MercuryActionType').CHANGE_ARCHIVED_STATUS:if(l.is_archived!=m.archived){l.is_archived=m.archived;this.$MercuryThreads21(m.thread_id);}break;case c('MercuryActionType').CHANGE_FOLDER:if(l.folder!=m.new_folder){l.folder=m.new_folder;this.$MercuryThreads21(m.thread_id);}break;case c('MercuryActionType').DELETE_MESSAGES:if(n){l.snippet='...';l.snippet_has_attachment=false;l.snippet_attachments=null;l.snippet_sender=null;this.$MercuryThreads21(m.thread_id);}else if(m.message_ids){l.message_count-=m.message_ids.length;c('ifRequired')('MercuryMessages',function(u){u=u.getForFBID(this.$MercuryThreads1);for(var v=m.message_ids,w=Array.isArray(v),x=0,v=w?v:v[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var y;if(w){if(x>=v.length)break;y=v[x++];}else{x=v.next();if(x.done)break;y=x.value;}var z=y,aa=u.getMessagesFromIDs([z]),ba=aa[0];if(ba&&ba.timestamp>l.last_read_timestamp)l.unread_count=Math.max(0,l.unread_count-1);}this.$MercuryThreads21(m.thread_id);}.bind(this),c('emptyFunction'));}break;case c('MercuryActionType').UPDATE_SNIPPET:c('ifRequired')('MercuryMessages',function(u){u=u.getForFBID(this.$MercuryThreads1);var v=0,w=1,x=u.getThreadMessagesRangeNow(m.thread_id,v,w),y=x[0];if(y){l.snippet=y.body;l.snippet_has_attachment=y.has_attachment;l.snippet_attachments=y.attachments;l.snippet_sender=y.author;}else{l.snippet='...';l.snippet_has_attachment=false;l.snippet_attachments=null;l.snippet_sender=null;u.getThreadMessagesRange(m.thread_id,v,w,function(z){if(z.length)this.$MercuryThreads5.handleUpdate({from_client:true,actions:[{thread_id:m.thread_id,action_type:c('MercuryActionType').UPDATE_SNIPPET,deleted_ids:m.deleted_ids}]});}.bind(this));}this.$MercuryThreads21(m.thread_id);}.bind(this),c('emptyFunction'));break;case c('MercuryActionType').UPDATE_BLOCKER_STATUS:l.can_reply=!!(!m.message_blocked&&(m.is_blocked_by_recipient===undefined||!m.is_blocked_by_recipient)&&l.is_subscribed&&!l.has_email_participant&&!l.read_only&&(l.recipients_loadable||l.recipients_loadable===undefined));this.$MercuryThreads21(m.thread_id);break;case c('MercuryActionType').UPDATE_BLOCKEE_STATUS:l.can_reply=!!(!m.got_blocked&&l.is_subscribed&&!l.has_email_participant&&!l.read_only&&(l.recipients_loadable||l.recipients_loadable===undefined));this.$MercuryThreads21(m.thread_id);break;case c('MercuryActionType').CHANGE_MUTE_SETTINGS:if(m.mute_settings!==undefined){var s=this.$MercuryThreads1+'@facebook.com';if(l.mute_settings){if(m.mute_settings){var t={};t[s]=m.mute_settings;l.mute_settings=babelHelpers['extends']({},l.mute_settings,t);}else{l.mute_settings=babelHelpers['extends']({},l.mute_settings);delete l.mute_settings[s];}this.$MercuryThreads21(l.thread_id);}}break;case c('MercuryActionType').ADD_PARTICIPANTS:this.$MercuryThreads22(l,m.participants);this.$MercuryThreads21(l.thread_id);break;case c('MercuryActionType').CHANGE_FLAG:this.$MercuryThreads26(l,m.mark_as_flag);this.$MercuryThreads21(l.thread_id);break;case c('MercuryActionType').MOVE_PENDING_TO_INBOX:this.$MercuryThreads27(l);this.$MercuryThreads21(l.thread_id);break;case c('MercuryActionType').UPDATE_CUSTOM_LIKE:l.custom_like_icon=m.custom_like;this.$MercuryThreads21(l.thread_id);break;}};j.prototype.$MercuryThreads24=function(l,m){if(m.log_message_data&&m.log_message_data.untypedData){var n=m.log_message_data.untypedData;switch(m.log_message_data.message_type){case c('MessagingGenericAdminTextType').THREAD_EPHEMERAL_SEND_MODE:var o=parseInt(n.ttl,10);if(o!==null&&l.ephemeral_ttl_mode!==o){l.ephemeral_ttl_mode=o;this.$MercuryThreads21(m.thread_id);}break;case c('MessagingGenericAdminTextType').CHANGE_THREAD_NICKNAME:var p={};for(var q in l.custom_nickname)p[q]=l.custom_nickname[q];p[n.participant_id]=n.nickname;l.custom_nickname=p;this.$MercuryThreads21(m.thread_id);break;case c('MessagingGenericAdminTextType').CHANGE_THREAD_ICON:c('requireWeak')('MercuryThreadActions',function(s){s.getForFBID(this.$MercuryThreads1).updateCustomLike(m.thread_id,n.thread_icon);}.bind(this));break;case c('MessagingGenericAdminTextType').CHANGE_THREAD_THEME:var r=n.theme_color;if(r.length>0){l.custom_color='#'.concat(r.substring(2));}else l.custom_color=null;this.$MercuryThreads21(m.thread_id);break;}}};j.prototype.$MercuryThreads16=function(l){var m=c('MercuryIDs').tokenize(l.thread_id),n=m.type,o=m.value,p=l.specific_to_list&&this.$MercuryThreads14(l.specific_to_list);return new (c('ImmutableObject'))({thread_id:l.thread_id,participants:l.specific_to_list,name:null,snippet:l.body,snippet_has_attachment:false,snippet_attachments:[],snippet_sender:l.author,unread_count:0,message_count:0,image_src:null,timestamp_absolute:l.timestamp_absolute,timestamp_relative:l.timestamp_relative,timestamp:l.timestamp,other_user_fbid:n==='user'?o:null,is_canonical_user:n==='user',is_canonical:p,is_subscribed:true,folder:c('MessagingTag').INBOX,is_archived:false});};j.prototype.$MercuryThreads25=function(l,m,n){if(m.timestamp)this.$MercuryThreads28(l.thread_id,n,m.timestamp);if(!l||!l.thread_id)return false;if(!l.timestamp){this.$MercuryThreads8.add(l.thread_id);return false;}var o=!l.unread_count;if(n==o)return false;l.unread_count=n?0:1;this.$MercuryThreads21(l.thread_id);return true;};j.prototype.$MercuryThreads29=function(l){var m=this.$MercuryThreads7.getAllResources();for(var n in m)if(m.hasOwnProperty(n)){var o=m[n];if(o.folder==l){this.$MercuryThreads7.setResource(n,c('ImmutableObject').setProperty(o,'unread_count',0));this.$MercuryThreads21(n);}}};j.prototype.$MercuryThreads22=function(l,m){var n=new (c('Set'))(l.participants);l.participants=Array.from(l.participants);m.forEach(function(o){if(!n.has(o)){l.participants.push(o);if(o===this.$MercuryThreads4){l.is_subscribed=true;l.can_reply=true;l.composer_enabled=true;if(c('MercuryConfig').WWWSyncThreadDFFOnViewerAdd){c('MercurySyncFakeDFFSender').sendThreadDFF(undefined,l.thread_fbid);}else this.$MercuryThreads2.fetchMissedMessages(c('MercuryFolders').getSupportedFolders(),c('MercuryAPIArgsSource').MERCURYSYNC,l.last_message_timestamp);}}}.bind(this));};j.prototype.$MercuryThreads23=function(l,m){var n=new (c('Set'))(m);l.participants=l.participants.filter(function(o){return !n.has(o);});if(n.has(this.$MercuryThreads4))l.is_subscribed=false;this.$MercuryThreads2.fetchThreadData([l.thread_id]);};j.prototype.$MercuryThreads20=function(l,m){if(!l.participants){var n=JSON.stringify({thread_info:l,participant:m});if(c('MercuryConfig').MercuryLogFromJSToFBLogger){var o=c('XMercuryFBLoggerController').getURIBuilder().setString('message',n).getURI();new (c('AsyncRequest'))().setURI(o).send();}i.debug('missing_participants',n);return;}var p=l.participants.indexOf(m);if(p>0)l.participants=[m].concat(l.participants.slice(0,p),l.participants.slice(p+1));};j.prototype.$MercuryThreads18=function(l,m){var n=m.body,o=m.subject,p='';if(o){o=o.toLowerCase();if(n.slice(0,o.length).toLowerCase()==o){p=n;}else if(n){p=o+' \u00B7 '+n;}else p=o;}else p=n;if(m.is_filtered_content)p=c('MercuryDisplayTimeFilterMessageRenderer').renderFilteredContent(m);if(c('MessagingGiftWrapChecker').shouldRenderWithGiftWrap(m)){var q=m.author,r=q==this.$MercuryThreads4,s=null;if(!r){s=l.custom_nickname&&l.custom_nickname[c('MercuryIDs').getUserIDFromParticipantID(q)];if(!s){var t=c('MercuryParticipants').getNow(q);if(t!=null)s=t.short_name;}}p=c('MercuryGiftSnippetRenderer').renderText(r,s);}l.snippet=p;l.snippet_has_attachment=m.has_attachment;if(m.raw_attachments&&m.raw_attachments.length>0){var u=c('MercuryAttachment').convertRaw(m.raw_attachments);l.snippet_attachments=u;}else l.snippet_attachments=m.attachments;if(!m.log_message_type)l.snippet_sender=m.author;};j.prototype.$MercuryThreads26=function(l,m){l.page_thread_info=babelHelpers['extends']({},l.page_thread_info,{flagged:m});};j.prototype.$MercuryThreads27=function(l){if(l.folder!==c('MessagingTag').PENDING)return;l.folder=c('MessagingTag').INBOX;};j.prototype.$MercuryThreads14=function(l){return l.filter(function(m){return m!=this.$MercuryThreads4;}.bind(this)).length<=1;};j.prototype.$MercuryThreads12=function(){this.$MercuryThreads5.subscribe('invalidate-thread-state',function(l,m){return this.$MercuryThreads30(m);}.bind(this));this.$MercuryThreads5.subscribe('invalidate-global-state',function(l,m){return this.$MercuryThreads31();}.bind(this));this.$MercuryThreads5.subscribe('update-threads',function(l,m){var n=(m.actions||[]).filter(function(o){return o.thread_id;});if(m.threads&&m.payload_source==c('MercuryPayloadSource').SERVER_FETCH_THREAD_INFO)m.threads.forEach(function(o){var p=o.thread_id;if(this.$MercuryThreads8.has(p)){this.$MercuryThreads8['delete'](p);if(o.unread_count)this.$MercuryThreads2.changeThreadReadStatus(o.thread_id,true);}}.bind(this));this.$MercuryThreads32(m.threads);this.$MercuryThreads15(n,m.from_client);m.threads&&m.threads.forEach(function(o){this.$MercuryThreads21(o.thread_id);}.bind(this));if(m.global_actions)m.global_actions.forEach(function(o){if(o.action_type==c('MercuryGlobalActionType').MARK_ALL_READ)this.$MercuryThreads29(o.folder);}.bind(this));if(this.$MercuryThreads6){this.$MercuryThreads6=false;h.emit('change');}}.bind(this));};j.prototype.$MercuryThreads32=function(l){if(!l||!l.length)return;var m={},n=[];l.forEach(function(o){var p=new (c('ImmutableObject'))(o);m[o.thread_id]=p;n.push(c('MercuryLoggingHelper').obfuscateThread(p));});n.length&&i.debug('threads_added',JSON.stringify({threads:n}));this.$MercuryThreads7.addResourcesAndExecute(m);};j.prototype.$MercuryThreads21=function(l){this.$MercuryThreads6=true;this.$MercuryThreads3.updatedThread(l);};j.prototype.$MercuryThreads19=function(l){this.$MercuryThreads6=true;this.$MercuryThreads3.deletedThread(l);};j.prototype.$MercuryThreads28=function(l,m,n){this.$MercuryThreads6=true;this.$MercuryThreads3.changedThreadReadState(l,m,n);};j.prototype.$MercuryThreads30=function(l){this.$MercuryThreads7.setResource(l,undefined);};j.prototype.$MercuryThreads31=function(){this.$MercuryThreads6=false;this.$MercuryThreads7=new (c('KeyedCallbackManager'))();this.$MercuryThreads8=new (c('Set'))();this.$MercuryThreads9=false;this.$MercuryThreads10=new (c('Set'))();this.$MercuryThreads11=new (c('Set'))();};var k=new (c('MercurySingletonProvider'))(j);f.exports=j;},null);
__d('MercuryTimestampTracker',['MercuryActionType','MercuryPayloadSource','MercurySingletonMixin','MercuryDispatcher'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i){this._fbid=i;this._dispatcher=c('MercuryDispatcher').getForFBID(this._fbid);this._lastTimestamp=0;this._dispatcher.subscribe('update-messages',function(j,k){if(!k.actions||!k.actions.length)return;if(k.payload_source==c('MercuryPayloadSource').CLIENT_SEND_MESSAGE||k.payload_source==c('MercuryPayloadSource').UNKNOWN)return;for(var l=0;l<k.actions.length;l++){var m=k.actions[l],n=m.action_type;if(n==c('MercuryActionType').USER_GENERATED_MESSAGE&&m.thread_id&&m.timestamp>this._lastTimestamp)this._lastTimestamp=m.timestamp;}}.bind(this));}Object.assign(h.prototype,{getLastUserMessageTimestamp:function(){return this._lastTimestamp;}});Object.assign(h,c('MercurySingletonMixin'));f.exports=h;},null);
__d('ChatTabModel',['Arbiter','ChatBehavior','ChatDispatcher','ChatConfig','ChatCookieInterface','ChatTabActions','EventEmitter','InitialServerTime','LogHistory','JSLogger','MercuryAssert','MercuryIDs','MercuryLocalIDs','MercuryThreadIDMap','MercuryThreads','MercuryTimestampTracker','PresenceState','PresenceUtil'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('MercuryThreadIDMap').get(),i=c('MercuryThreads').get(),j=c('MercuryTimestampTracker').get(),k=c('InitialServerTime').serverTime,l=c('ChatConfig').get('tab_max_load_age')||3600000,m=20,n=new (c('EventEmitter'))(),o=c('LogHistory').getInstance('chat_tab_model'),p={tabs:[],promotedID:null,lastChangeTime:0,lastChangeReason:null,isInitialized:false,localRaised:null};function q(ma){var na=c('ChatCookieInterface').load(ma,p);na&&u();return na;}function r(ma,na,oa){var pa=q(c('PresenceState').get());if(na===undefined||na>p.lastChangeTime){if(ma()){pa=true;p.lastChangeReason=oa||null;t(na);}}else o.error('rejected',JSON.stringify({change_time:na,state_time:p.lastChangeTime}));pa&&s();}function s(){if(p.isInitialized)n.emit('change');}function t(ma){if(ma===undefined)ma=Math.max(j.getLastUserMessageTimestamp()||1,p.lastChangeTime+1);p.lastChangeTime=ma;c('PresenceState').doSync();}function u(ma){var na=p.tabs.length-m;if(na>0)p.tabs=p.tabs.filter(function(oa){return oa.raised||oa.id==ma||na--<=0;});if(na>0)p.tabs=p.tabs.filter(function(oa){return (oa.id==p.promotedID||oa.id==ma||na--<=0);});}function v(ma){for(var na=0;na<p.tabs.length;na++)if(p.tabs[na].id==ma)return na;return -1;}function w(ma,na){var oa=i.getThreadMetaNow(ma);if(!oa)return false;if(oa.is_canonical_user){return z(ma,na);}else{var pa=y(ma);if(pa)h.getServerIDFromClientID(ma,function(qa){if(ca(ma,qa)){t();s();}});return pa;}}function x(ma){c('MercuryAssert').isThreadID(ma);if(y(ma))s();}function y(ma){if(v(ma)===-1){p.tabs.push({id:ma,fragile:true});o.log('open_fragile_tab',JSON.stringify({tabs:JSON.stringify(p.tabs),opened:ma,window_id:c('PresenceUtil').getSessionID()}));return true;}return false;}function z(ma,na){var oa=v(ma);if(oa!=-1)if(p.tabs[oa].fragile){p.tabs.splice(oa,1);}else{na&&(p.tabs[oa].signatureID=na);return true;}for(var pa=0;pa<=p.tabs.length;pa++)if(pa==p.tabs.length||p.tabs[pa].fragile){p.tabs.splice(pa,0,{id:ma,signatureID:na});u(ma);o.log('open_tab',JSON.stringify({tabs:JSON.stringify(p.tabs),opened:ma,window_id:c('PresenceUtil').getSessionID()}));return true;}}function aa(ma,na,oa){c('MercuryAssert').isThreadID(ma);var pa=false;if(p.localRaised&&na){p.localRaised[ma]=true;pa=true;}r(function(){if(w(ma,oa))pa=true;var qa=v(ma);if(qa!=-1&&!p.tabs[qa].raised){p.tabs[qa].raised=true;pa=true;o.log('raise_tab',JSON.stringify({tabs:JSON.stringify(p.tabs),raised:ma,window_id:c('PresenceUtil').getSessionID()}));}return pa;});}function ba(ma){if(v(ma)!==-1&&p.promotedID!==ma){p.promotedID=ma;return true;}return false;}function ca(ma,na){var oa=v(ma);if(oa!=-1&&p.tabs[oa].fragile){var pa=p.tabs[oa];pa.fragile=c('MercuryIDs').isLocalThread(ma);pa.server_id=na;var qa=[];p.tabs.forEach(function(ra){if(ra.id!=ma){if(pa&&ra.fragile){qa.push(pa);pa=null;}qa.push(ra);}});if(pa)qa.push(pa);p.tabs=qa;o.log('make_permanent',JSON.stringify({tabs:JSON.stringify(p.tabs),tab_id:ma,window_id:c('PresenceUtil').getSessionID()}));return true;}return false;}function da(ma,na){c('MercuryAssert').isThreadID(ma);var oa=false;if(p.localRaised){delete p.localRaised[ma];oa=true;}r(function(){if(ea(ma))oa=true;return oa;},undefined,na);}function ea(ma){var na=v(ma);if(ma==p.promotedID)p.promotedID=null;if(na!=-1){p.tabs.splice(na,1);o.log('close_tab',JSON.stringify({tabs:JSON.stringify(p.tabs),closed:ma,window_id:c('PresenceUtil').getSessionID()}));return true;}return false;}function fa(){if(p.tabs.length){o.log('close_all_tabs',JSON.stringify({closed_tabs:JSON.stringify(p.tabs),window_id:c('PresenceUtil').getSessionID()}));p.tabs=[];p.promotedID=null;if(p.localRaised)p.localRaised={};t();s();}}function ga(){var ma=[];for(var na=0;na<p.tabs.length;na++)if(p.tabs[na].fragile&&!i.isNewEmptyLocalThread(p.tabs[na].id)){ma.push(p.tabs[na]);p.tabs.splice(na);s();break;}o.log('close_fragile_tabs',JSON.stringify({tabs:JSON.stringify(p.tabs),fragile_closed:ma,window_id:c('PresenceUtil').getSessionID()}));}function ha(ma){c('MercuryAssert').isThreadID(ma);var na=false;if(p.localRaised){delete p.localRaised[ma];na=true;}r(function(){var oa=v(ma);if(oa!=-1&&p.tabs[oa].raised){delete p.tabs[oa].raised;o.log('lower_tab',JSON.stringify({tabs:JSON.stringify(p.tabs),lowered:ma,window_id:c('PresenceUtil').getSessionID()}));na=true;}return na;});}function ia(){if(p.localRaised){r(function(){var ma=false;p.tabs.forEach(function(na){if(na.raised!=p.localRaised[na.id]){ma=true;if(p.localRaised[na.id]){na.raised=true;}else delete na.raised;}});return ma;});o.log('persist_local_raise',JSON.stringify({tabs:JSON.stringify(p.tabs),window_id:c('PresenceUtil').getSessionID()}));}}c('PresenceState').registerStateStorer(function(ma){return c('ChatCookieInterface').store(ma,p);});c('PresenceState').registerStateLoader(function(ma){if(q(ma))s();});var ja=null,ka={getDispatchToken:function(){return ja;},isTabPromoted:function(ma){if(ma)return ma==p.promotedID;return false;},indexOf:function(ma){return v(ma);},getTab:function(ma){c('MercuryAssert').isThreadID(ma);var na=this.indexOf(ma);if(na>-1){var oa=p.tabs[na];return babelHelpers['extends']({},oa);}return null;},getEmptyTab:function(){var ma;for(var na=0;na<p.tabs.length;na++){ma=p.tabs[na].id;if(i.isNewEmptyLocalThread(ma))return ma;}ma=c('MercuryLocalIDs').generateThreadID();i.createNewLocalThread(ma,[]);return ma;},get:function(){var ma=p.tabs.map(function(na){var oa=babelHelpers['extends']({},na);delete oa.fragile;if(p.localRaised)oa.raised=p.localRaised[oa.id];return oa;});return {tabs:ma,promoted:p.promotedID};},promoteThreadInPlaceOfThread:function(ma,na,oa,pa){c('MercuryAssert').isThreadID(ma);c('MercuryAssert').isThreadID(na);r(function(){var qa=v(ma),ra=v(na);if(pa){p.promotedID=ma;}else if(p.promotedID===na)return true;var sa=p.tabs[qa];if(oa){c('MercuryAssert').isThreadID(oa);var ta=v(oa),ua=p.tabs[ra];p.tabs[ra]=sa;p.tabs.splice(qa,1);p.tabs.splice(ta,0,ua);}else{p.tabs[qa]=p.tabs[ra];p.tabs[ra]=sa;}return true;});},addListener:function(ma){return n.addListener('change',ma);}};c('Arbiter').subscribe(c('JSLogger').DUMP_EVENT,function(ma,na){na.chat_tabs={promoted:p.promotedID,tabs:p.tabs.map(function(oa){return babelHelpers['extends']({},oa);}),time:p.lastChangeTime,max_load_age:l};});function la(){var ma=c('ChatBehavior').ignoresRemoteTabRaise();if(ma&&!p.localRaised){o.log('start_ignore_remote_raise','{}');p.localRaised={};s();}else if(!ma&&p.localRaised){o.log('stop_ignore_remote_raise','{}');p.localRaised=null;s();}}ja=c('ChatDispatcher').register(function(ma){switch(ma.actionType){case c('ChatTabActions').Types.CLOSE_TAB:da(ma.threadID,ma.reason);break;case c('ChatTabActions').Types.CLOSE_ALL_TABS:fa();break;case c('ChatTabActions').Types.CLOSE_FRAGILE_TABS:ga();break;case c('ChatTabActions').Types.LOWER_TAB:ha(ma.threadID);break;case c('ChatTabActions').Types.OPEN_FRAGILE_TAB:x(ma.threadID);break;case c('ChatTabActions').Types.OPEN_TAB:c('MercuryAssert').isThreadID(ma.threadID);r(function(){return w(ma.threadID);});break;case c('ChatTabActions').Types.PERSIST_LOCAL_STATE:ia();break;case c('ChatTabActions').Types.PROMOTE_TAB:c('MercuryAssert').isThreadID(ma.threadID);r(ba.bind(null,ma.threadID));break;case c('ChatTabActions').Types.RAISE_TAB:aa(ma.threadID,ma.userAction,ma.signatureID);break;}});c('ChatBehavior').subscribe(c('ChatBehavior').ON_CHANGED,la);la();q(c('PresenceState').getInitial(),true);if(p.lastChangeTime===0)p.lastChangeTime=k-600000;p.isInitialized=true;f.exports=ka;},null);
__d('AccessibilityLogger',['AsyncSignal','Cookie'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={COOKIE:'a11y',DECAY_MS:6*60*60*1000,DEFAULT:{sr:0,'sr-ts':Date.now(),jk:0,'jk-ts':Date.now(),kb:0,'kb-ts':Date.now(),hcm:0,'hcm-ts':Date.now()},getCookie:function(){var i=h.DEFAULT,j=c('Cookie').get(h.COOKIE);if(j){j=JSON.parse(j);for(var k in i)if(k in j)i[k]=j[k];}return i;},logKey:function(i,j){var k=h.getCookie();k[i]++;var l=Date.now();if(l-k[i+'-ts']>h.DECAY_MS){new (c('AsyncSignal'))('/ajax/accessibilitylogging',{eventName:j,times_pressed:k[i]}).send();k[i+'-ts']=l;k[i]=0;}c('Cookie').set(h.COOKIE,JSON.stringify(k));},logHCM:function(){h.logKey('hcm','hcm_users');},logSRKey:function(){h.logKey('sr','sr_users');},logJKKey:function(){h.logKey('jk','jk_users');},logFocusIn:function(){h.logKey('kb','kb_users');}};f.exports=h;},null);